import { Injectable } from '@angular/core';
import { BehaviorSubject, map } from 'rxjs';
import { FetchUserPullInfoGQL } from 'src/app/graphql/pulling.graphql-gen';

export interface UserPullInfo {
  Cart: string;
  CartPulls: number;
  UserPulls: number;
}

@Injectable()
export class UserPullInfoService {
  constructor(private _fetchUserPullInfo: FetchUserPullInfoGQL) {}

  private _userPullInfo = new BehaviorSubject<UserPullInfo>(null);

  public getUserPullInfo$() {
    return this._fetchUserPullInfo
      .fetch(
        {
          userID: Number(JSON.parse(sessionStorage.getItem('userInfo'))._id),
          statusID: 110,
        },
        { fetchPolicy: 'network-only' }
      )
      .pipe(
        map((res) => {
          return res.data.fetchUserPullInfo.map((info) => ({
            Cart: info.Cart,
            CartPulls: info.CartPulls,
            UserPulls: info.UserPulls,
          }));
        })
      );
  }
}
