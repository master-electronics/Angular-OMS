<div class="px-4 py-4 mx-auto">
    <div nz-row nzGutter="8" nzJustify="start">
        <div nz-col nzSpan="24" style="height: 30px"></div>
    </div>
    <div nz-row nzGutter="8" nzJustify="start">
        <div nz-col nzSpan="4">
            Receipt ID
        </div>
        <div nz-col nzSpan="4">
            Vendor ID
        </div>
        <div nz-col nzSpan="3">
            Expected Arrival Date
        </div>
        <div nz-col nzSpan="4">
            Source
        </div>
    </div>
    <div nz-row nzGutter="8" nzJustify="start">
        <div nz-col nzSpan="4">
            <nz-select style="width: 80%; float: left" nzShowSearch
                nzPlaceHolder="Receipt ID" [nzShowArrow]="false"
                [nzFilterOption]="nzFilterOption"
                (nzOnSearch)="searchReceipts($event)"
                [(ngModel)]="receiptID" #receiptSearch
                name="receiptSearchSel" nzAllowClear
                (ngModelChange)="onReceiptIDChange($event)">
                <nz-option *ngFor="let receipt of receiptList"
                    [nzLabel]="receipt.text" [nzValue]="receipt.value">
                </nz-option>
            </nz-select>
            <span nz-icon nzType="plus"
                nzTheme="outline" class="icon"
                (click)="insertReceipt()"></span>
        </div>
        <div nz-col nzSpan="4">
            <nz-select style="width: 100%" nzShowSearch nzAllowClear
                [(ngModel)]="vendorID" #vendorSelect id="vendorID"
                [class]="vendorSearchClass" nzPlaceHolder="Vendor ID">
                <nz-option *ngFor="let vendor of vendorList"
                    nzLabel="{{ vendor.label }}"
                    nzValue="{{ vendor.value }}"></nz-option>
            </nz-select>
        </div>
        <div nz-col nzSpan="3">
            <nz-date-picker [(ngModel)]="expectedArrivalDate"></nz-date-picker>
        </div>
        <div nz-col nzSpan="4">
            <nz-select style="width: 90%" nzPlaceHolder="Source"
                [(ngModel)]="sourceType" [nzOptions]="sourceTypeOptions">
            </nz-select>
        </div>
    </div>
    <div nz-row>
        <div nz-col nzSpan="24" style="height: 30px"></div>
    </div>
    <div nz-row nzGutter="8" nzJustify="start">
        <div nz-col nzSpan="4">
            Part Number
        </div>
        <div nz-col nzSpan="2">
            Quantity
        </div>
        <div nz-col nzSpan="2">
            Date Code
        </div>
        <div nz-col nzSpan="2">
            Country of Origin
        </div>
        <div nz-col nzSpan="2">
            ROHS
        </div>
        <div nz-col nzSpan="1"></div>
        <div nz-col nzSpan="1"></div>
    </div>
    <div nz-row nzGutter="8" nzJustify="start">
        <div nz-col nzSpan="4">
            <nz-select style="width: 100%" nzShowSearch
                nzPlaceHolder="Part Number" [nzShowArrow]="false"
                [nzFilterOption]="nzFilterOption"
                (nzOnSearch)="searchPartNumbers($event)"
                [(ngModel)]="partNumberID" nzAllowClear
                #partSearch name="partSearchSel"
                [disabled]="!receiptSelected"
                [class]="partNumberClass"
                (ngModelChange)="onPartNumberClick($event)"
            >
                <nz-option *ngFor="let part of partList"
                    [nzLabel]="part.text" [nzValue]="part.value">
                </nz-option>
            </nz-select>
            <!--<input nz-input [(ngModel)]="partNumber"
             [disabled]="!receiptSelected" placeholder="Part Number"
             (keyup)="onPartNumberChange($event)" />
            <div class="searchResults" *ngIf="partCodes">
                <div *ngFor="let partCode of partCodes" (click)="onPartNumberClick(partCode.PRC, partCode._id)">
                    {{ partCode.PRC }}
                </div>
            </div>-->
        </div>
        <div nz-col nzSpan="2">
            <input nz-input [(ngModel)]="quantity" type="number"
                [disabled]="!receiptSelected" placeholder="Quantity"
                [ngClass]="quantityClass" />
        </div>
        <div nz-col nzSpan="2">
            <input nz-input [(ngModel)]="dateCode"
             [disabled]="!receiptSelected" placeholder="Date Code"
             [ngClass]="dateCodeClass" />
        </div>
        <div nz-col nzSpan="2">
            <nz-select [(ngModel)]="coo" style="width: 100%"
                [disabled]="!receiptSelected" nzPlaceHolder="Country of Origin"
                nzShowSearch nzAllowClear (ngModelChange)="onCountryChange($event)"
            >
                <nz-option *ngFor="let country of countryList"
                    nzLabel="{{ country.label }}"
                    nzValue="{{ country.value }}"
                    >
                </nz-option>
            </nz-select>
        </div>
        <div nz-col nzSpan="2">
            <nz-select [(ngModel)]="rohs" style="width: 100%"
                [nzOptions]="rohsOptions" [disabled]="!receiptSelected"
                nzPlaceHolder="ROHS" nzAllowClear nzShowSearch>
            </nz-select>
        </div>
        <div *ngIf="receiptLineID" nz-col nzSpan="5">
            <button nz-button
                style="margin-right: 10px;" nz-popconfirm
                nzPopconfirmTitle="Are you sure you want to delete this line?"
                (nzOnConfirm)="deleteReceiptLine()"
            >
                Delete
            </button>
            <button nz-button (click)="saveReceiptLine()"
                style="margin-right: 10px;"
            >
                Save
            </button>
            <button nz-button (click)="clearReceiptLine()"
            style="margin-right: 10px;"
            >
                Clear
            </button>
            <button nz-button (click)="addReceiptLineDetail()">
                Add Detail
            </button>
        </div>
        <div *ngIf="!receiptLineID" nz-col nzSpan="2">
            <button nz-button (click)="addReceiptLine()"
                [disabled]="!receiptSelected">
                Add
            </button>
        </div>
    </div>
    <div nz-row nzGutter="8">
        <div nz-col nzSpan="24" style="height: 30px"></div>
    </div>
    <nz-table #receiptLineTable [nzData]="receiptLines">
        <thead>
            <tr>
                <th nzWidth="55px"></th>
                <th nzWidth="80px">Line #</th>
                <th nzWidth="300px">Part #</th>
                <th nzWidth="100px">Quantity</th>
                <th nzWidth="100px">Date Code</th>
                <th nzWidth="80px">CoO</th>
                <th nzWidth="80px">ROHS</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <ng-template ngFor let-data [ngForOf]="receiptLineTable.data">
                <tr>
                    <td [(nzExpand)]="data.Expanded"></td>
                    <td>{{ data.LineNumber }}</td>
                    <td>{{ data.PartNumber }}</td>
                    <td>{{ data.ExpectedQuantity }}</td>
                    <td>{{ data.DateCode }}</td>
                    <td>{{ data.ISO3 }}</td>
                    <td>{{ data.ROHS }}</td>
                    <td>
                        <button nz-button (click)="selectReceiptLine(data._id)">
                            Select
                        </button>
                    </td>
                </tr>
                <tr [nzExpand]="data.Expanded">
                    <nz-table #receiptLineDetailTable [nzData]="data.ReceiptLineDetails">
                        <thead>
                            <tr>
                                <th nzWidth="300px">PO Line</th>
                                <th nzWidth="100px">Quantity</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of receiptLineDetailTable.data">
                                <td>{{ data.PurchaseOrderNumberLine }}</td>
                                <td>{{ data.ExpectedQuantity }}</td>
                                <td>
                                    <button nz-button  style="margin-right: 10px"
                                        (click)="selectReceiptLineDetail(
                                            data._id, data.PurchaseOrderLID,
                                            data.PurchaseOrderNumberLine,
                                            data.ExpectedQuantity)"
                                    >
                                        Edit
                                    </button>
                                    <button nz-button
                                        nz-popconfirm
                                        nzPopconfirmTitle="Are you sure you want to delete this line detail?"
                                        (nzOnConfirm)="deleteReceiptLineDetail(data._id, data.ReceiptLID)"
                                    >
                                        Delete
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </tr>
            </ng-template>
        </tbody>
    </nz-table>
    <nz-modal [(nzVisible)]="receiptLineDetailVisible" 
        [nzTitle]="lineDetailTitleTemplate"
        (nzOnCancel)="hideReceiptLineDetail()" [nzClosable]="receiptLineDetailClosable"
        [nzOkDisabled]="!poLineID || !receiptLineDetailQuantity" 
        [nzCancelDisabled]="receiptLineDetailCancelDisabled"
        nzMaskClosable="false" (nzOnOk)="onReceiptLineDetailOKClick()" 
        [nzCancelText]="null" [nzOkText]="receiptLineDetailOkText">
        <ng-template #lineDetailTitleTemplate>Expected Quantity: {{ quantity }}<br />Total Quantity: {{ lineDetailTotal }}</ng-template>
        <ng-container *nzModalContent>
            <div nz-row nzGutter="8" nzJustify="start">
                <div nz-col nzSpan="10">
                    PO Number-Line
                </div>
                <div nz-col nzSpan="10">
                    Quantity
                </div>
            </div>
            <div *ngIf="lineDetails.length > 0">
                <div nz-row nzGutter="8" nzJustify="start"
                    *ngFor="let lineDetail of lineDetails; let i=index;">
                    <span nz-col nzSpan="10">
                        {{ lineDetail.PurchaseOrderNumberLine }}
                    </span>
                    <span nz-col nzSpan="10">
                        {{ lineDetail.Quantity }}
                    </span>
                    <button nz-button (click)="removeDetailLine(i)">
                        <span nz-icon nzType="delete" nzTheme="outline"></span>
                    </button>
                </div>
            </div>
            <div nz-row nzGutter="8" nzJustify="start">
                <div nz-col nzSpan="10">
                    <nz-select nzShowSearch nzPlaceHolder="PO Line"
                        (nzOnSearch)="searchPOLines($event)" [(ngModel)]="poLineID"
                        nzAllowClear style="width: 100%" [nzShowArrow]="false"
                        (nzFocus)="resetReceiptLineDetailMessage()"
                    >
                        <nz-option *ngFor="let poLine of poLineList"
                            [nzLabel]="poLine.text" [nzValue]="poLine.value">
                        </nz-option>
                    </nz-select>
                </div>
                <div nz-col nzSpan="10">
                    <input nz-input placeholder="Quantity" [(ngModel)]="receiptLineDetailQuantity"
                        (focus)="resetReceiptLineDetailMessage()" type="number" />
                </div>
                <button nz-button (click)="addDetailLine()">
                    <span nz-icon nzType="plus" nzTheme="outline"></span>
                </button>
            </div>
            <div *ngIf="receiptLineDetailMessage">
                <div nz-row nzGutter="8" style="height: 10px;"></div>
                <div nz-row nzGutter="8" nzJustify="start">
                    <div nz-col nzSpan="24">
                        <ng-container>
                            <nz-alert
                                [nzType]="
                                    receiptLineDetailAlertType === 'error'
                                        ? 'error'
                                        : receiptLineDetailAlertType === 'success'
                                        ? 'success'
                                        : receiptLineDetailAlertType === 'info'
                                        ? 'info'
                                        : 'warning'
                                "
                                [nzMessage]="receiptLineDetailMessage"
                                nzShowIcon class="w-full" style="width: 100%">
                            </nz-alert>
                        </ng-container>
                    </div>
                </div>
            </div>
            <button nz-button (click)="test2()">test</button>
        </ng-container>
    </nz-modal>
    <button nz-button (click)="test($event)">test</button>
</div>