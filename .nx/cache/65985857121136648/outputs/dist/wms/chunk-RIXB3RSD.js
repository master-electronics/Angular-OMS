import{a as me,b as he,c as fe,d as ge,e as ve,f as be,g as _e,h as Te,i as ye,j as Se,k as Ce}from"./chunk-EDQ2XWAO.js";import{a as pe}from"./chunk-GKR6SDXW.js";import{a as ce}from"./chunk-RMIKNTFD.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import{a as G}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import{a as ue,d as de}from"./chunk-44NJU3LR.js";import"./chunk-Z347V25R.js";import{E as le,H as se,I as ae,d as K,h as X,i as Y,o as Z,p as ee,t as te,u as ie,w as ne,x as re,y as oe}from"./chunk-L3THJMBJ.js";import"./chunk-GJX7JKAF.js";import"./chunk-5FUULRSO.js";import{c as H}from"./chunk-V5UEWFGK.js";import"./chunk-C55YZZU5.js";import{a as R,c as J,e as W,f as q}from"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import{m as $,n as Q}from"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as B,k as V}from"./chunk-PJEV5NXI.js";import{A as j,p as A,q as U,w as D}from"./chunk-GWV5DZOT.js";import{$b as g,Ba as M,C as b,Da as z,Fb as c,Gb as s,Gc as P,H as C,Ia as F,Ja as N,Lc as I,Mc as L,N as E,Sb as d,V as T,ac as r,bc as o,cc as m,dc as k,ec as w,gc as O,nc as p,pc as _,qa as y,xc as v,zc as x}from"./chunk-N7LPRJLK.js";function ze(l,a){l&1&&m(0,"div")}function ke(l,a){if(l&1&&(r(0,"option",23),v(1),o()),l&2){let u=a.$implicit;d("ngValue",u),c(1),x(" ",u.name," ")}}function we(l,a){if(l&1&&(r(0,"option",24),v(1),o()),l&2){let u=a.$implicit;d("ngValue",u)("disabled",u.disabled),c(1),x(" ",u.name," ")}}function Oe(l,a){if(l&1&&(r(0,"div",25),m(1,"message-bar",26),o()),l&2){let u=_();c(1),d("message",u.error.message)("name",u.errorType)}}function Pe(l,a){if(l&1){let u=O();k(0),r(1,"popup-modal",27),p("clickSubmit",function(){F(u);let i=_();return N(i.onOk())})("clickCancel",function(){F(u);let i=_();return N(i.onCancel())}),o(),w()}if(l&2){let u=_();c(1),d("message",u.message)}}function Ae(l,a){l&1&&m(0,"div")}var at=(()=>{let a=class a{constructor(e,i,t,n,f,h,S,Fe,Ne,xe,Ie,Le,Ee,Me){this.route=e,this.router=i,this._fetchAuditTypes=t,this._findITN=n,this._findLocation=f,this._findProductCode=h,this._findProduct=S,this._findITNs=Fe,this._insertAudits=Ne,this._findPRCITNs=xe,this._findPRCPartNumITNs=Ie,this._validateFilter=Le,this._fb=Ee,this._auditService=Me,this.userInfo=M(G),this.auditTypeList=[],this.includedAuditTypeList=[{name:"Location",value:10,disabled:!0}]}ngOnInit(){this.data$=this._fetchAuditTypes.fetch({},{fetchPolicy:"network-only"}).pipe(C(e=>{e.data.fetchAuditTypes.forEach(i=>{i.Type!="Location"&&this.auditTypeList.push({name:i.Type,value:i._id,disabled:i.Type=="Location"})})})),this.inputForm=this._fb.group({itn:[{value:null,disabled:!1}],location:[{value:null,disabled:!1}],endLocation:[{value:null,disabled:!1}],prc:[{value:null,disabled:!1}],partNumber:[{value:null,disabled:!1}]}),this.onChanges()}onChanges(){this.inputForm.get("itn").valueChanges.subscribe(e=>{e?(this.inputForm.get("location").disable({onlySelf:!0,emitEvent:!1}),this.inputForm.get("endLocation").disable({onlySelf:!0,emitEvent:!1}),this.inputForm.get("prc").disable({onlySelf:!0,emitEvent:!1}),this.inputForm.get("partNumber").disable({onlySelf:!0,emitEvent:!1})):(this.inputForm.get("location").enable({onlySelf:!0,emitEvent:!1}),this.inputForm.get("endLocation").enable({onlySelf:!0,emitEvent:!1}),this.inputForm.get("prc").enable({onlySelf:!0,emitEvent:!1}),this.inputForm.get("partNumber").enable({onlySelf:!0,emitEvent:!1}))}),this.inputForm.get("location").valueChanges.subscribe(e=>{e?this.inputForm.get("itn").disable({onlySelf:!0,emitEvent:!1}):this.inputForm.get("itn").enable({onlySelf:!0,emitEvent:!1})}),this.inputForm.get("endLocation").valueChanges.subscribe(e=>{e?this.inputForm.get("itn").disable({onlySelf:!0,emitEvent:!1}):this.inputForm.get("itn").enable({onlySelf:!0,emitEvent:!1})}),this.inputForm.get("prc").valueChanges.subscribe(e=>{e||this.inputForm.value.partNumber?this.inputForm.get("itn").disable({onlySelf:!0,emitEvent:!1}):this.inputForm.get("itn").enable({onlySelf:!0,emitEvent:!1})}),this.inputForm.get("partNumber").valueChanges.subscribe(e=>{e||this.inputForm.value.prc?this.inputForm.get("itn").disable({onlySelf:!0,emitEvent:!1}):this.inputForm.get("itn").enable({onlySelf:!0,emitEvent:!1})})}onSubmit(){if(this.error=null,this.errorType=null,!this.inputForm.value.itn&&!this.inputForm.value.location&&!this.inputForm.value.endLocation&&!this.inputForm.value.prc&&!this.inputForm.value.partNumber){this.error={message:"Select Filter!"};return}let e=this.inputForm.value.itn!=""?this.inputForm.value.itn:null,i=this.inputForm.value.location!=""?this.inputForm.value.location:null,t=this.inputForm.value.endLocation!=""?this.inputForm.value.endLocation:null,n=this.inputForm.value.prc!=""?this.inputForm.value.prc:null,f=this.inputForm.value.partNumber!=""?this.inputForm.value.partNumber:null;this.data$=this._validateFilter.fetch({itn:e,locationStart:i,locationEnd:t,prc:n,partNumber:f}).pipe(y(h=>{if(!h.data.validateFilter)throw new Error("errored")}),C(()=>(this.displayAuditCount(),!0)),T(h=>{let S=h.message.toString().substring(h.message.toString().indexOf('"')+1,h.message.toString().indexOf('"',h.message.toString().indexOf('"')+1));return this.error={message:S},b({error:{message:h.message,type:"error"}})}))}onBack(){this.router.navigate(["../menu"],{relativeTo:this.route})}displayAuditCount(){this.itnList=[],this.data$=this._findITNs.fetch({itn:this.inputForm.value.itn?this.inputForm.value.itn:null,barcodeStart:this.inputForm.value.location?this.inputForm.value.location.toString():null,barcodeEnd:this.inputForm.value.endLocation?this.inputForm.value.endLocation.toString():null,prc:this.inputForm.value.prc?this.inputForm.value.prc.toString():null,partNumber:this.inputForm.value.partNumber?this.inputForm.value.partNumber.toString():null},{fetchPolicy:"network-only"}).pipe(y(e=>{e.data.findIMInventories.forEach(n=>{this.itnList.push({_id:Number(n._id),ITN:n.InventoryTrackingNumber,oldID:n.oldID})});let i=this.itnList.filter(n=>n.oldID),t=this.itnList.filter(n=>!n.oldID);this.itnList=t,this.message=`${t.length} audit${e.data.findIMInventories.length>1?"s":""} will be created.`,i&&(this.message+="<br /><br />",i.length>=3?this.message+=`${i.length} ITNs will not have audits created because they have active picks.`:i.length!=0&&(this.message+="The following ITNs will not have audits created because they have active picks:<br />",i.forEach(n=>{this.message+=`
                ${n.ITN}<br />`})))}),T(e=>b(!1)))}onOk(){let e=[],i=[];this.itnList.length>0&&(this.itnList.forEach(t=>{i.push(this._auditService.inventoryUpdate(this.userInfo.userName,t.ITN,"Inventory Management Audit","","","","","true")),this.includedAuditTypeList.forEach(n=>{e.push({TypeID:Number(n.value),InventoryID:Number(t._id),LastUpdated:new Date(Date.now()).toISOString(),CreatedDatetime:new Date(Date.now()).toISOString()})})}),this.suspect$=E(i),this.data$=this._insertAudits.mutate({audits:e}).pipe(y(()=>(this.errorType="success",this.error={message:"Audits created!"},this.removeAll(),this.inputForm.reset(),b(!0))),T(t=>(this.errorType="error",this.error={message:t.message},b({error:{message:t.message,type:"error"}}))))),this.message=null}onCancel(){this.itnList=null,this.message=null}includeSelected(){this.selectedTypes.forEach(e=>{if(!this.includedAuditTypeList.find(t=>t==e)){this.includedAuditTypeList.push(e);let t=this.auditTypeList.indexOf(e);this.auditTypeList.splice(t,1)}}),this.includedAuditTypeList.sort((e,i)=>Number(e.value)<Number(i.value)?-1:Number(e.value)==Number(i.value)?0:1)}includeAll(){this.auditTypeList.forEach(e=>{this.includedAuditTypeList.find(t=>t==e)||this.includedAuditTypeList.push(e)}),this.includedAuditTypeList.sort((e,i)=>Number(e.value)<Number(i.value)?-1:Number(e.value)==Number(i.value)?0:1),this.auditTypeList.splice(0,this.auditTypeList.length)}removeSelected(){this.selectedRemoveTypes.forEach(e=>{if(!this.auditTypeList.find(t=>t==e)){this.auditTypeList.push(e);let t=this.includedAuditTypeList.indexOf(e);this.includedAuditTypeList.splice(t,1)}}),this.auditTypeList.sort((e,i)=>Number(e.value)<Number(i.value)?-1:Number(e.value)==Number(i.value)?0:1)}removeAll(){this.includedAuditTypeList.forEach(e=>{e.name!="Location"&&(this.auditTypeList.find(t=>t==e)||this.auditTypeList.push(e))}),this.auditTypeList.sort((e,i)=>Number(e.value)<Number(i.value)?-1:Number(e.value)==Number(i.value)?0:1),this.includedAuditTypeList.splice(1,this.includedAuditTypeList.length)}};a.\u0275fac=function(i){return new(i||a)(s(B),s(V),s(me),s(ve),s(he),s(fe),s(ge),s(be),s(Se),s(_e),s(Te),s(ye),s(le),s(Ce))},a.\u0275cmp=z({type:a,selectors:[["ng-component"]],standalone:!0,features:[P],decls:50,vars:13,consts:[[4,"ngIf"],[1,"flexContainer"],[1,"title"],[1,"container"],["multiple","","size","8",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["nz-icon","","nzType","right","nzTheme","outline",1,"button",3,"click"],["nz-icon","","nzType","vertical-left","nzTheme","outline",1,"button",3,"click"],["nz-icon","","nzType","left","nzTheme","outline",1,"button",3,"click"],["nz-icon","","nzType","vertical-right","nzTheme","outline",1,"button",3,"click"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],[3,"formGroup","ngSubmit"],[1,"inputBox"],["nz-input","","placeholder","ITN","nzSize","large","formControlName","itn"],["nz-input","","placeholder","Location","nzSize","large","formControlName","location"],["nz-input","","placeholder","End Location","nzSize","large","formControlName","endLocation"],["nz-input","","placeholder","PRC","nzSize","large","formControlName","prc"],["nz-input","","placeholder","Part Number","nzSize","large","formControlName","partNumber"],[1,"buttonContainer"],["nz-button","","type","submit","nzType","primary","nzSize","large",1,"w-full",3,"click"],["nz-button","","type","default","nzSize","large",1,"backButton","w-full",3,"click"],["class","alertContainer",4,"ngIf"],[1,"clear"],[3,"ngValue"],[3,"ngValue","disabled"],[1,"alertContainer"],[3,"message","name"],[3,"message","clickSubmit","clickCancel"]],template:function(i,t){i&1&&(g(0,ze,1,0,"div",0),I(1,"async"),r(2,"div",1)(3,"div",2),v(4,"Select Audit Types"),o()(),r(5,"div",1)(6,"div",3)(7,"select",4),p("ngModelChange",function(f){return t.selectedTypes=f}),g(8,ke,2,2,"option",5),o()(),r(9,"div")(10,"div")(11,"div")(12,"span",6),p("click",function(){return t.includeSelected()}),o()(),r(13,"div")(14,"span",7),p("click",function(){return t.includeAll()}),o()(),r(15,"div")(16,"span",8),p("click",function(){return t.removeSelected()}),o()(),r(17,"div")(18,"span",9),p("click",function(){return t.removeAll()}),o()()()(),r(19,"div",3)(20,"select",4),p("ngModelChange",function(f){return t.selectedRemoveTypes=f}),g(21,we,2,3,"option",10),o()()(),r(22,"div",1)(23,"div",2),v(24,"Select Filter"),o(),r(25,"form",11),p("ngSubmit",function(){return t.onSubmit()}),r(26,"div",1)(27,"div",12),m(28,"input",13),o(),r(29,"div",12),m(30,"input",14),o(),r(31,"div",12),m(32,"input",15),o(),r(33,"div",12),m(34,"input",16),o(),r(35,"div",12),m(36,"input",17),o()()()(),r(37,"div",1)(38,"div",18)(39,"button",19),p("click",function(){return t.onSubmit()}),v(40," Submit "),o()(),r(41,"div",18)(42,"button",20),p("click",function(){return t.onBack()}),v(43," Back "),o()()(),r(44,"div",1),g(45,Oe,2,2,"div",21),o(),g(46,Pe,2,1,"ng-container",0),m(47,"div",22),g(48,Ae,1,0,"div",0),I(49,"async")),i&2&&(d("ngIf",L(1,9,t.data$)),c(7),d("ngModel",t.selectedTypes),c(1),d("ngForOf",t.auditTypeList),c(12),d("ngModel",t.selectedRemoveTypes),c(1),d("ngForOf",t.includedAuditTypeList),c(4),d("formGroup",t.inputForm),c(20),d("ngIf",t.error),c(1),d("ngIf",t.message),c(2),d("ngIf",L(49,11,t.suspect$)))},dependencies:[j,A,U,D,se,ee,ne,oe,K,re,X,Y,Z,H,Q,$,de,ue,ae,te,ie,ce,pe,q,W,R,J],styles:[".box[_ngcontent-%COMP%]{margin:auto;width:17%}.bigBox[_ngcontent-%COMP%]{margin:auto;width:43%;text-align:center;padding-top:20px}.title[_ngcontent-%COMP%]{text-align:center;padding:5px 10px;width:100%}.leftbox[_ngcontent-%COMP%]{float:left;position:relative;width:135px}.middlebox[_ngcontent-%COMP%]{float:left;position:relative;padding:10px}.rightbox[_ngcontent-%COMP%]{float:left;position:relative;width:135px}select[_ngcontent-%COMP%]{border:solid 1px #d9d9d9;border-radius:2px;width:100%}select[_ngcontent-%COMP%]:focus{border:solid 1px #40a9ff;box-shadow:-2px -2px 2px #d1e9ff}select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{color:#bfbfbf}.buttonContainer[_ngcontent-%COMP%]{max-width:200px;width:100%;display:inline-block}.button[_ngcontent-%COMP%]{border:solid 1px #d9d9d9;border-radius:2px;padding:15px;margin-bottom:5px;cursor:pointer}.button[_ngcontent-%COMP%]:hover{border:solid 1px #40a9ff}.backButton[_ngcontent-%COMP%]{background-color:#1f2937;color:#9ca3af}.backButton[_ngcontent-%COMP%]:hover{background-color:#374151;color:#fff}.clear[_ngcontent-%COMP%]{position:relative;clear:both}.textInput[_ngcontent-%COMP%]{float:left;width:200px;padding:2px 2px 30px}.textInput[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.inputBox[_ngcontent-%COMP%]{width:200px;display:inline-block}.flexContainer[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;gap:5px;padding-bottom:10px}.container[_ngcontent-%COMP%]{min-width:100px;max-width:125px;width:100%}.alertContainer[_ngcontent-%COMP%]{max-width:85%;width:100%}form[_ngcontent-%COMP%]{width:100%}"]});let l=a;return l})();export{at as UserTrigger};
