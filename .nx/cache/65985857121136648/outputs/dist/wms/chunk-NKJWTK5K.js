import{a as z}from"./chunk-QTNYEYCW.js";import{b as Q}from"./chunk-CHDKWY6V.js";import"./chunk-CNRANGED.js";import{a as J}from"./chunk-GKR6SDXW.js";import{a as q}from"./chunk-XHQXBUEX.js";import"./chunk-RMIKNTFD.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import{a as x}from"./chunk-MFWTQF6C.js";import{a as I}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as $}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{E as O,I as U,e as G,i as P,t as V}from"./chunk-L3THJMBJ.js";import{a as S}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as j,k as M}from"./chunk-PJEV5NXI.js";import{A as R,q as F,w as B}from"./chunk-GWV5DZOT.js";import{$b as A,C as m,Da as b,Fb as p,Gb as a,Gc as w,H as c,I as N,Ia as C,Ja as y,Lc as g,Mc as v,Sb as s,V as l,ac as f,bc as d,cc as T,dc as E,ec as k,gc as D,nc as _,pc as h,qa as L}from"./chunk-N7LPRJLK.js";function X(i,n){if(i&1){let u=D();E(0),f(1,"popup-modal",2),_("clickSubmit",function(){C(u);let e=h();return y(e.onBack())}),d(),k()}if(i&2){let u=h();p(1),s("message",u.error)}}function Y(i,n){i&1&&T(0,"div")}var dt=(()=>{let n=class n{constructor(o,e,t,r,H,K,W){this._findContainer=o,this._actRoute=e,this._router=t,this._fb=r,this._asn=H,this._eventLog=K,this._userInfo=W,this.inputForm=this._fb.nonNullable.group({location:["",[G.required]]})}ngOnInit(){sessionStorage.getItem("asn-itn")?this.selectedITN=sessionStorage.getItem("asn-itn"):this.error="ITN must be scanned first!",this.data$=m(!0)}onSubmit(){let o=this.inputForm.value.location.toString();this.itnList=[];let e;this.data$=this._findContainer.fetch({container:{Barcode:this.inputForm.value.location.toString()},barcode:this.inputForm.value.location.toString(),statusList:["Open","Closed","CANCELLED"]},{fetchPolicy:"network-only"}).pipe(L(t=>{if(!t.data.findContainer)throw new Error("Can't find this Location!");if(t.data.verifyASNLocationNotInProcess.length>0)throw new Error("ASN for this location In Process");e=t.data.findContainer._id}),c(t=>t.data.verifyASNLocation),c(t=>{if(t.map(r=>{this.itnList.push(r.InventoryTrackingNumber)}),this.itnList.length>0)throw new Error("Location has ITNs not bound for Autostore");this.log$=this._eventLog.insertLog([{UserEventID:I.Event_Autostore_ASN_Location_Scanned,UserName:this._userInfo.userName,DistributionCenter:S.DistributionCenter,InventoryTrackingNumber:this.selectedITN,Message:"Location: "+o}],[{UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_Location_Scanned,Log:JSON.stringify({DistributionCenter:S.DistributionCenter,InventoryTrackingNumber:this.selectedITN,Location:o})}]),this.data$=N({location:this._asn.moveItnToLocation(this.selectedITN,e,this._userInfo.userName,o).pipe(c(()=>{this._router.navigate(["../scan-itn"],{relativeTo:this._actRoute})}),l(r=>(this.error=r,m({error:{message:r.message,type:"error"}})))),status:this._asn.updateASNReplenishmentItem(Number(JSON.parse(sessionStorage.getItem("asnReplenishmentItem"))._id),"In-process")}),sessionStorage.removeItem("asnReplenishmentItem")}),l(t=>m({error:{message:t.message,type:"error"}})))}onBack(){this._router.navigate(["../scan-itn"],{relativeTo:this._actRoute})}};n.\u0275fac=function(e){return new(e||n)(a(x),a(j),a(M),a(O),a(Q),a(z),a($))},n.\u0275cmp=b({type:n,selectors:[["ng-component"]],standalone:!0,features:[w],decls:5,vars:9,consts:[["controlName","location","title","Scan Location:",3,"data","formGroup","isvalid","formSubmit","formBack"],[4,"ngIf"],[3,"message","clickSubmit"]],template:function(e,t){e&1&&(f(0,"single-input-form",0),_("formSubmit",function(){return t.onSubmit()})("formBack",function(){return t.onBack()}),g(1,"async"),d(),A(2,X,2,1,"ng-container",1)(3,Y,1,0,"div",1),g(4,"async")),e&2&&(s("data",v(1,5,t.data$))("formGroup",t.inputForm)("isvalid",t.inputForm.valid),p(2),s("ngIf",t.error),p(1),s("ngIf",v(4,7,t.log$)))},dependencies:[R,F,B,q,U,P,V,J],encapsulation:2});let i=n;return i})();export{dt as ASNLocation};
