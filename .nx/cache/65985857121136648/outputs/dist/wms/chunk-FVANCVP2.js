import{a as st}from"./chunk-Z6BDTNTK.js";import{a as at}from"./chunk-5VGBK5M2.js";import{k as ut}from"./chunk-EDQ2XWAO.js";import{a as it}from"./chunk-QTNYEYCW.js";import{a as ot}from"./chunk-GKR6SDXW.js";import{a as rt}from"./chunk-XHQXBUEX.js";import"./chunk-RMIKNTFD.js";import{a as nt}from"./chunk-ZOYJBT7K.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import"./chunk-J3DDCTFF.js";import{a as c}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as z}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{e as et}from"./chunk-TREYRKOP.js";import{g as tt}from"./chunk-MZCJXFXF.js";import{E as X,H as Y,I as Z,e as E,i as K,t as W}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-WX6KJXZ2.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{a as G,b as j,c as q}from"./chunk-V5UEWFGK.js";import{a as d}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as $,k as H}from"./chunk-PJEV5NXI.js";import{A as J,q as V,w as x}from"./chunk-GWV5DZOT.js";import{$b as D,Ba as B,C as m,Da as w,Fb as s,Gb as g,Gc as R,H as v,Ia as k,Ja as L,Lc as b,Mc as A,Q as F,Sb as u,V as S,ac as l,bc as P,cc as C,dc as T,ec as h,f as U,gc as M,na as i,nc as f,pc as _,qa as O,xc as Q}from"./chunk-N7LPRJLK.js";function pt(o,a){if(o&1&&(T(0),C(1,"audit-info",8),h()),o&2){let p=_();s(1),u("auditInfo",p.auditInfo)}}function mt(o,a){if(o&1){let p=M();T(0),l(1,"popup-modal",9),f("clickSubmit",function(){k(p);let t=_();return L(t.onBack())}),P(),h()}if(o&2){let p=_();s(1),u("message",p.message)}}function yt(o,a){if(o&1){let p=M();T(0),l(1,"popup-modal",9),f("clickSubmit",function(){k(p);let t=_();return L(t.resetTimeout())}),P(),h()}if(o&2){let p=_();s(1),u("message",p.timeoutAlert)}}function vt(o,a){o&1&&C(0,"div")}function gt(o,a){o&1&&C(0,"div")}var xt=(()=>{let a=class a{constructor(e,t,r,n,I){this._fb=e,this._router=t,this._actRoute=r,this._auditService=n,this._eventLog=I,this.userInfo=B(z),this.inputForm=this._fb.nonNullable.group({dateCode:["",[E.required,E.pattern(tt)]]}),this.timeoutSeconds=0}ngOnInit(){if(sessionStorage.getItem("currentAudit")){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.lastUpdated=Number(e.LastUpdated),this.auditInfo={Container:{Barcode:e.Container.Barcode},Inventory:{ITN:e.Inventory.ITN,Product:{PartNumber:e.Inventory.Product.PartNumber,ProductCode:{ProductCodeNumber:e.Inventory.Product.ProductCode.ProductCodeNumber}}}}}this.info$=this._actRoute.data.pipe(v(e=>{this.auditTimeout=e?.Config?.auditTimeout?.data?.fetchConfigValue.Value,this.alertTime=e?.Config?.alertTime?.data?.fetchConfigValue?.Value;let t=F(1e3);this.subscription=t.subscribe(r=>this.timer())})),this.data$=m(!0)}timer(){++this.timeoutSeconds;let e=(this.lastUpdated+this.auditTimeout*1e3-(this.timeoutSeconds*1e3+this.lastUpdated))/1e3;if(e==0){this._router.navigate(["../../menu"],{relativeTo:this._actRoute});return}e==this.alertTime&&(new st().beep(100,520),this.showTimeoutAlert=!0);let t=Math.floor(e/60),r=e%60,n=t<10?"0"+t.toString():t.toString(),I=r<10?"0"+r.toString():r.toString();this.timeoutAlert="Audit will timeout in "+n+":"+I}resetTimeout(){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.updateLastUpdated(e.InventoryID,10,new Date(Date.now()).toISOString()).pipe(v(()=>{e.LastUpdated=new Date(Date.now()).getTime().toString(),sessionStorage.setItem("currentAudit",JSON.stringify(e))}),S(t=>m({error:t}))),this.timeoutSeconds=0,this.showTimeoutAlert=!1}onChange(e){this.inputForm.patchValue({dateCode:e})}onInputFocus(e){this.currentInputField=this.inputForm.get(`field${e.target.id}`)}onSubmit(){return U(this,null,function*(){let e=this.inputForm.value.dateCode,t=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.validateAssignment$(t._id,this.userInfo.userId).pipe(v(r=>{if(r.data.validateAssignment){let n=[{UserEventID:c.Event_IM_DateCode_Entered,UserName:this.userInfo.userName,DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Date Code: "+this.inputForm.value.dateCode}],I=[{UserName:this.userInfo.userName,EventTypeID:c.Event_IM_DateCode_Entered,Log:JSON.stringify({DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,DateCodeEntered:this.inputForm.value.dateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}];return e!=JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.DateCode&&(n.push({UserEventID:c.Event_IM_DateCode_Updated,UserName:this.userInfo.userName,DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Original Date Code: "+JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.DateCode+" --- New Date Code: "+e}),I.push({UserName:this.userInfo.userName,EventTypeID:c.Event_IM_DateCode_Updated,Log:JSON.stringify({DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost,NewDateCode:e})})),this.data$=this._eventLog.insertLog(n,I).pipe(i(()=>this._auditService.updateLastUpdated(t.InventoryID,30,new Date(Date.now()).toISOString())),i(()=>this._auditService.updateLastUpdated(t.InventoryID,10,new Date(Date.now()).toISOString())),i(y=>this._auditService.inventoryUpdate(this.userInfo.userName,sessionStorage.getItem("auditITN"),"Inventory Management Audit","",e)),i(y=>this._auditService.deleteAudit(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,30)),i(y=>this._auditService.nextSubAudit$(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,this.userInfo.userId).pipe(O(N=>{if(N)return this._router.navigate(["../"+N.Route],{relativeTo:this._actRoute}),N;{let dt=[{UserEventID:c.Event_IM_Audit_Completed,UserName:this.userInfo.userName,DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN")}],ct=[{UserName:this.userInfo.userName,EventTypeID:c.Event_IM_Audit_Completed,Log:JSON.stringify({DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,DateCodeEntered:e,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}];return this.close$=this._eventLog.insertLog(dt,ct).pipe(i(lt=>this._auditService.closeAudit(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,10,JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.ITN,this.userInfo.userName).pipe(v(It=>(this._router.navigate(["../verify/scan-itn"],{relativeTo:this._actRoute}),It))))),m(!0)}}))),S(y=>m({error:{message:y.message,type:"error"}}))),m(!0)}else return this.message="This Audit has timed out!",sessionStorage.removeItem("currentAudit"),sessionStorage.removeItem("auditITN"),m(!0)}))})}onBack(){this._router.navigate(["../scan-itn"],{relativeTo:this._actRoute})}onNA(){let e=JSON.parse(sessionStorage.getItem("currentAudit")),t=[{UserEventID:c.Event_IM_DateCode_NA,UserName:this.userInfo.userName,DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:e.Inventory.ITN}],r=[{UserName:this.userInfo.userName,EventTypeID:c.Event_IM_DateCode_NA,Log:JSON.stringify({DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:e.Inventory.ParentITN,BinLocation:e.Container.Barcode,QuantityOnHand:e.Inventory.Quantity,OriginalQuantity:e.Inventory.OriginalQuantity,DateCode:e.Inventory.DateCode,CountryOfOrigin:e.Inventory.COO,ROHS:e.Inventory.ROHS,NotFound:e.Inventory.NotFound,Suspect:e.Inventory.Suspect,LocatedInAutostore:e.Inventory.LocatedInAutostore,BoundForAutostore:e.Inventory.BoundForAutostore,PartNumber:e.Inventory.Product.PartNumber,ProductCode:e.Inventory.Product.ProductCode.ProductCodeNumber,Description:e.Inventory.Product.Description,ProductTier:e.Inventory.Product.ProductTier,ProductType:e.Inventory.Product.ProductType.ProductType,ProductTypeDescription:e.Inventory.Product.ProductType.Description,Velocity:e.Inventory.Product.Velocity,MICPartNumber:e.Inventory.Product.MICPartNumber,UOM:e.Inventory.Product.UOM,Autostore:e.Inventory.Product.Autostore,PackType:e.Inventory.Product.PackType,PackQuantity:e.Inventory.Product.PackQty,Cost:e.Inventory.Product.Cost})}];this.data$=this._eventLog.insertLog(t,r).pipe(i(()=>this._auditService.updateLastUpdated(e.InventoryID,30,new Date(Date.now()).toISOString())),i(()=>this._auditService.updateLastUpdated(e.InventoryID,10,new Date(Date.now()).toISOString())),i(()=>{let n=[{InventoryID:e.InventoryID,Reason:"User selected N/A for Date Code",Comment:`Date Code of ${e.Inventory.DateCode} expected`}];return this._auditService.insertSuspect(n)}),i(()=>this._auditService.deleteAudit(e.InventoryID,30)),i(()=>this._auditService.nextSubAudit$(e.InventoryID,this.userInfo.userId).pipe(O(n=>{if(n)return this._router.navigate(["../"+n.Route],{relativeTo:this._actRoute}),n;{let I=[{UserEventID:c.Event_IM_Audit_Completed,UserName:this.userInfo.userName,DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:e.Inventory.ITN}],y=[{UserName:this.userInfo.userName,EventTypeID:c.Event_IM_Audit_Completed,Log:JSON.stringify({DistributionCenter:d.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:e.Inventory.ParentITN,BinLocation:e.Container.Barcode,QuantityOnHand:e.Inventory.Quantity,OriginalQuantity:e.Inventory.OriginalQuantity,DateCode:e.Inventory.DateCode,DateCodeEntered:"N/A",CountryOfOrigin:e.Inventory.COO,ROHS:e.Inventory.ROHS,NotFound:e.Inventory.NotFound,Suspect:e.Inventory.Suspect,LocatedInAutostore:e.Inventory.LocatedInAutostore,BoundForAutostore:e.Inventory.BoundForAutostore,PartNumber:e.Inventory.Product.PartNumber,ProductCode:e.Inventory.Product.ProductCode.ProductCodeNumber,Description:e.Inventory.Product.Description,ProductTier:e.Inventory.Product.ProductTier,ProductType:e.Inventory.Product.ProductType.ProductType,ProductTypeDescription:e.Inventory.Product.ProductType.Description,Velocity:e.Inventory.Product.Velocity,MICPartNumber:e.Inventory.Product.MICPartNumber,UOM:e.Inventory.Product.UOM,Autostore:e.Inventory.Product.Autostore,PackType:e.Inventory.Product.PackType,PackQuantity:e.Inventory.Product.PackQty,Cost:e.Inventory.Product.Cost})}];return this.close$=this._eventLog.insertLog(I,y).pipe(i(()=>this._auditService.closeAudit(e.InventoryID,10,e.Inventory.ITN,this.userInfo.userName).pipe(v(N=>(this._router.navigate(["../verify/scan-itn"],{relativeTo:this._actRoute}),N))))),m(!0)}}))),S(n=>m({error:{message:n.message,type:"error"}})))}ngOnDestroy(){this.subscription.unsubscribe()}};a.\u0275fac=function(t){return new(t||a)(g(X),g(H),g($),g(ut),g(it))},a.\u0275cmp=w({type:a,selectors:[["ng-component"]],standalone:!0,features:[R],decls:16,vars:16,consts:[[4,"ngIf"],["inputType","string","controlName","dateCode","title","Enter Date Code:",3,"data","formGroup","isvalid","formSubmit","formBack"],[2,"height","20px"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","8","nzOffset","8",1,"grid","h-12"],["type","button",1,"h-full","w-full","rounded-lg","bg-red-700","font-medium","text-white","hover:bg-red-500","focus:outline-none","focus:ring-4","focus:ring-red-300","disabled:bg-red-200","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-900",3,"click"],[2,"height","200px"],["layout","number",3,"inputString","outputString"],[3,"auditInfo"],[3,"message","clickSubmit"]],template:function(t,r){t&1&&(D(0,pt,2,1,"ng-container",0),l(1,"single-input-form",1),f("formSubmit",function(){return r.onSubmit()})("formBack",function(){return r.onBack()}),b(2,"async"),P(),C(3,"div",2),l(4,"div",3)(5,"div",4)(6,"button",5),f("click",function(){return r.onNA()}),Q(7," N/A "),P()()(),C(8,"div",6),l(9,"simple-keyboard",7),f("outputString",function(I){return r.onChange(I)}),P(),D(10,mt,2,1,"ng-container",0)(11,yt,2,1,"ng-container",0)(12,vt,1,0,"div",0),b(13,"async"),D(14,gt,1,0,"div",0),b(15,"async")),t&2&&(u("ngIf",r.auditInfo),s(1),u("data",A(2,10,r.data$))("formGroup",r.inputForm)("isvalid",r.inputForm.valid),s(3),u("nzGutter",8),s(5),u("inputString",r.inputForm.value.dateCode),s(1),u("ngIf",r.message),s(1),u("ngIf",r.showTimeoutAlert),s(1),u("ngIf",A(13,12,r.info$)),s(2),u("ngIf",A(15,14,r.close$)))},dependencies:[J,V,x,rt,Z,K,W,ot,et,q,j,G,Y,at,nt],encapsulation:2});let o=a;return o})();export{xt as DateCodeAudit};
