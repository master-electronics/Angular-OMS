import{a as gt}from"./chunk-Z6BDTNTK.js";import{a as vt}from"./chunk-5VGBK5M2.js";import{k as lt}from"./chunk-EDQ2XWAO.js";import{a as It}from"./chunk-QTNYEYCW.js";import{a as yt}from"./chunk-GKR6SDXW.js";import{a as mt}from"./chunk-XHQXBUEX.js";import"./chunk-RMIKNTFD.js";import{a as pt}from"./chunk-ZOYJBT7K.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import"./chunk-J3DDCTFF.js";import{a as I}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as K}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{c as ot,d as ut,e as st}from"./chunk-TREYRKOP.js";import{b as at,c as dt,d as ct}from"./chunk-JOHRHLSX.js";import"./chunk-Z347V25R.js";import{E as nt,H as rt,I as it,e as X,h as Y,i as Z,o as tt,t as et}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-WX6KJXZ2.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{c as W}from"./chunk-V5UEWFGK.js";import{a as y}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as q,k as G}from"./chunk-PJEV5NXI.js";import{A as j,p as J,q as H,w as $}from"./chunk-GWV5DZOT.js";import{$b as f,Ba as x,C as p,Da as V,Fb as a,Gb as h,Gc as F,H as S,Hc as z,Ia as g,Ja as _,Lc as D,Mc as O,Q as E,Sb as s,V as A,Vc as R,ac as l,bc as v,cc as N,dc as T,ec as b,f as M,gc as P,na as c,nc as C,pc as d,qa as L,sc as w,wc as U,xc as Q,yc as B}from"./chunk-N7LPRJLK.js";function Ct(i,u){if(i&1&&(T(0),N(1,"audit-info",8),b()),i&2){let n=d();a(1),s("auditInfo",n.auditInfo)}}function ht(i,u){if(i&1){let n=P();l(0,"single-input-form",9),C("formSubmit",function(){g(n);let e=d();return _(e.onSubmit())})("formBack",function(){g(n);let e=d();return _(e.onBack())}),D(1,"async"),v()}if(i&2){let n=d();s("data",O(1,3,n.data$))("formGroup",n.inputForm)("isvalid",n.inputForm.valid)}}function ft(i,u){if(i&1){let n=P();l(0,"single-input-form",10),C("formSubmit",function(){g(n);let e=d();return _(e.onSubmit())})("formBack",function(){g(n);let e=d();return _(e.onBack())}),D(1,"async"),v()}if(i&2){let n=d();s("data",O(1,3,n.data$))("formGroup",n.inputForm)("isvalid",n.inputForm.valid)}}function Pt(i,u){if(i&1){let n=P();T(0),l(1,"popup-modal",11),C("clickSubmit",function(){g(n);let e=d();return _(e.onBack())}),v(),b()}if(i&2){let n=d();a(1),s("message",n.message)}}function St(i,u){if(i&1){let n=P();T(0),l(1,"popup-modal",11),C("clickSubmit",function(){g(n);let e=d();return _(e.resetTimeout())}),v(),b()}if(i&2){let n=d();a(1),s("message",n.timeoutAlert)}}function At(i,u){i&1&&N(0,"div")}function Nt(i,u){i&1&&N(0,"div")}function Tt(i,u){i&1&&Q(0,"Adjust Reason")}function bt(i,u){if(i&1&&(l(0,"label",14),Q(1),v()),i&2){let n=u.$implicit;w("nzValue",n),a(1),B(n)}}function Dt(i,u){if(i&1){let n=P();T(0),l(1,"nz-radio-group",12),C("ngModelChange",function(e){g(n);let r=d();return _(r.adjustReason=e)}),f(2,bt,2,2,"label",13),v(),b()}if(i&2){let n=d();a(1),s("ngModel",n.adjustReason),a(1),s("ngForOf",n.reasons)}}var Ot=()=>({top:"5px"}),ne=(()=>{let u=class u{constructor(t,e,r,o,m){this._fb=t,this._router=e,this._actRoute=r,this._auditService=o,this._eventLog=m,this.userInfo=x(K),this.inputForm=this._fb.nonNullable.group({quantity:["",[X.required]]}),this.counts=[],this.timeoutSeconds=0,this.cancelText=null}ngOnInit(){if(this.userEventLogs=[],this.eventLogs=[],this.reasons=[],sessionStorage.getItem("auditITN")||this._router.navigate(["../../menu"],{relativeTo:this._actRoute}),sessionStorage.getItem("currentAudit")){let t=JSON.parse(sessionStorage.getItem("currentAudit"));this.CurrentAudit=t,this.lastUpdated=Number(t.LastUpdated),this.auditInfo={Container:{Barcode:t.Container.Barcode},Inventory:{ITN:t.Inventory.ITN,Product:{PartNumber:t.Inventory.Product.PartNumber,ProductCode:{ProductCodeNumber:t.Inventory.Product.ProductCode.ProductCodeNumber}}}},this.info$=this._actRoute.data.pipe(S(e=>{e?.Config?.imAdjustReasons?.forEach(o=>{this.reasons.push(o)}),this.auditTimeout=e?.Config?.auditTimeout?.data?.fetchConfigValue?.Value,this.alertTime=e?.Config?.alertTime?.data?.fetchConfigValue?.Value;let r=E(1e3);this.subscription=r.subscribe(o=>this.timer())}))}this.data$=p(!0)}onOk(){this.userEventLogs.push({UserEventID:I.Event_IM_Quantity_Updated,UserName:this.userInfo.userName,DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Original Quantity: "+JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.Quantity+" --- New Quantity: "+this.Quantity+" --- Cost: "+JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.Product.Cost}),this.eventLogs.push({UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Quantity_Updated,Log:JSON.stringify({DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:this.CurrentAudit.Inventory.ParentITN,BinLocation:this.CurrentAudit.Container.Barcode,QuantityOnHand:this.CurrentAudit.Inventory.Quantity,OriginalQuantity:this.CurrentAudit.Inventory.OriginalQuantity,DateCode:this.CurrentAudit.Inventory.DateCode,CountryOfOrigin:this.CurrentAudit.Inventory.COO,ROHS:this.CurrentAudit.Inventory.ROHS,NotFound:this.CurrentAudit.Inventory.NotFound,Suspect:this.CurrentAudit.Inventory.Suspect,LocatedInAutostore:this.CurrentAudit.Inventory.LocatedInAutostore,BoundForAutostore:this.CurrentAudit.Inventory.BoundForAutostore,PartNumber:this.CurrentAudit.Inventory.Product.PartNumber,ProductCode:this.CurrentAudit.Inventory.Product.ProductCode.ProductCodeNumber,Description:this.CurrentAudit.Inventory.Product.Description,ProductTier:this.CurrentAudit.Inventory.Product.ProductTier,ProductType:this.CurrentAudit.Inventory.Product.ProductType.ProductType,ProductTypeDescription:this.CurrentAudit.Inventory.Product.ProductType.Description,Velocity:this.CurrentAudit.Inventory.Product.Velocity,MICPartNumber:this.CurrentAudit.Inventory.Product.MICPartNumber,UOM:this.CurrentAudit.Inventory.Product.UOM,Autostore:this.CurrentAudit.Inventory.Product.Autostore,PackType:this.CurrentAudit.Inventory.Product.PackType,PackQuantity:this.CurrentAudit.Inventory.Product.PackQty,Cost:this.CurrentAudit.Inventory.Product.Cost,NewQuantity:this.Quantity,UpdateReason:this.adjustReason})}),this.reasonsVisible=!1;let t=Number(this.Quantity)==0?null:20;this.closeAudit(this.Quantity,t)}closeAudit(t,e){this.data$=this._eventLog.insertLog(this.userEventLogs,this.eventLogs).pipe(c(()=>this._auditService.updateLastUpdated(this.CurrentAudit.InventoryID,20,new Date(Date.now()).toISOString())),c(()=>this._auditService.updateLastUpdated(this.CurrentAudit.InventoryID,10,new Date(Date.now()).toISOString())),c(r=>this._auditService.inventoryUpdate(this.userInfo.userName,sessionStorage.getItem("auditITN"),"Inventory Management Audit",t.toString())),c(r=>this._auditService.deleteAudit(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,e)),c(r=>this._auditService.nextSubAudit$(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,this.userInfo.userId).pipe(L(o=>{if(o)return this._router.navigate(["../"+o.Route],{relativeTo:this._actRoute}),o;{let m=[{UserEventID:I.Event_IM_Audit_Completed,UserName:this.userInfo.userName,DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN")}],k=[{UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Audit_Completed,Log:JSON.stringify({DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:this.CurrentAudit.Inventory.ParentITN,BinLocation:this.CurrentAudit.Container.Barcode,QuantityEntered:t,QuantityOnHand:this.CurrentAudit.Inventory.Quantity,OriginalQuantity:this.CurrentAudit.Inventory.OriginalQuantity,DateCode:this.CurrentAudit.Inventory.DateCode,CountryOfOrigin:this.CurrentAudit.Inventory.COO,ROHS:this.CurrentAudit.Inventory.ROHS,NotFound:this.CurrentAudit.Inventory.NotFound,Suspect:this.CurrentAudit.Inventory.Suspect,LocatedInAutostore:this.CurrentAudit.Inventory.LocatedInAutostore,BoundForAutostore:this.CurrentAudit.Inventory.BoundForAutostore,PartNumber:this.CurrentAudit.Inventory.Product.PartNumber,ProductCode:this.CurrentAudit.Inventory.Product.ProductCode.ProductCodeNumber,Description:this.CurrentAudit.Inventory.Product.Description,ProductTier:this.CurrentAudit.Inventory.Product.ProductTier,ProductType:this.CurrentAudit.Inventory.Product.ProductType.ProductType,ProductTypeDescription:this.CurrentAudit.Inventory.Product.ProductType.Description,Velocity:this.CurrentAudit.Inventory.Product.Velocity,MICPartNumber:this.CurrentAudit.Inventory.Product.MICPartNumber,UOM:this.CurrentAudit.Inventory.Product.UOM,Autostore:this.CurrentAudit.Inventory.Product.Autostore,PackType:this.CurrentAudit.Inventory.Product.PackType,PackQuantity:this.CurrentAudit.Inventory.Product.PackQty,Cost:this.CurrentAudit.Inventory.Product.Cost})}];return this.close$=this._eventLog.insertLog(m,k).pipe(c(Qt=>this._auditService.closeAudit(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,10,JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.ITN,this.userInfo.userName).pipe(S(_t=>(this._router.navigate(["../verify/scan-itn"],{relativeTo:this._actRoute}),_t))))),p(!0)}}))),A(r=>p({error:{message:r.message,type:"error"}})))}timer(){++this.timeoutSeconds;let t=(this.lastUpdated+this.auditTimeout*1e3-(this.timeoutSeconds*1e3+this.lastUpdated))/1e3;if(t==0){this._router.navigate(["../../menu"],{relativeTo:this._actRoute});return}t==this.alertTime&&(new gt().beep(100,520),this.showTimeoutAlert=!0);let e=Math.floor(t/60),r=t%60,o=e<10?"0"+e.toString():e.toString(),m=r<10?"0"+r.toString():r.toString();this.timeoutAlert="Audit will timeout in "+o+":"+m}resetTimeout(){let t=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.updateLastUpdated(t.InventoryID,10,new Date(Date.now()).toISOString()).pipe(S(()=>{t.LastUpdated=new Date(Date.now()).getTime().toString(),sessionStorage.setItem("currentAudit",JSON.stringify(t))}),A(e=>p({error:e}))),this.timeoutSeconds=0,this.showTimeoutAlert=!1}onChange(t){this.inputForm.patchValue({quantity:t})}onSubmit(){return M(this,null,function*(){this.userEventLogs=[],this.eventLogs=[];let t=JSON.parse(sessionStorage.getItem("currentAudit")),e=Number(this.inputForm.value.quantity);this.info$=this._auditService.validateAssignment$(t._id,this.userInfo.userId).pipe(S(r=>{if(r.data.validateAssignment){if(this.counts.length==0)this.counts.push(e),this.data$=this._eventLog.insertLog([{UserEventID:I.Event_IM_Quantity_Entered,UserName:this.userInfo.userName,DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Quantity: "+e}],[{UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Quantity_Entered,Log:JSON.stringify({DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityEntered:e,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}]).pipe(c(()=>this._auditService.updateLastUpdated(t.InventoryID,20,new Date(Date.now()).toISOString())),c(()=>this._auditService.updateLastUpdated(t.InventoryID,10,new Date(Date.now()).toISOString())),c(()=>{if(Number(e)==t.Inventory.Quantity){let o=Number(e)==0?null:20;this.closeAudit(e,o)}return p(!0)}),A(o=>p({error:{message:o.message,type:"error"}})));else if(Number(e)==this.counts[0]){let o=e,m=Number(o)==0?null:20;if(this.userEventLogs.push({UserEventID:I.Event_IM_Quantity_Confirm_Entered,UserName:this.userInfo.userName,DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Quantity: "+o}),this.eventLogs.push({UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Quantity_Confirm_Entered,Log:JSON.stringify({DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityEntered:o,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}),Number(o)!=Number(JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.Quantity))return this.CurrentAudit=t,this.Quantity=o,this.reasonsVisible=!0,p(!0);this.closeAudit(e,m)}else this.counts=[],this.data$=this._eventLog.insertLog([{UserEventID:I.Event_IM_Quantity_Confirm_Entered,UserName:this.userInfo.userName,DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Quantity: "+e.toString()}],[{UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Quantity_Confirm_Entered,Log:JSON.stringify({DistributionCenter:y.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityEntered:e,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}]).pipe(c(()=>this._auditService.updateLastUpdated(t.InventoryID,20,new Date(Date.now()).toISOString())),c(()=>this._auditService.updateLastUpdated(t.InventoryID,10,new Date(Date.now()).toISOString())),A(o=>p({error:{message:o.message,type:"error"}})));return p(!0)}else return this.message="This Audit has timed out!",sessionStorage.removeItem("currentAudit"),sessionStorage.removeItem("auditITN"),p(!0)}))})}onBack(){this._router.navigate(["../scan-itn"],{relativeTo:this._actRoute})}ngOnDestroy(){this.subscription.unsubscribe()}};u.\u0275fac=function(e){return new(e||u)(h(nt),h(G),h(q),h(lt),h(It))},u.\u0275cmp=V({type:u,selectors:[["ng-component"]],standalone:!0,features:[F],decls:15,vars:18,consts:[[4,"ngIf"],["inputType","number","controlName","quantity","title","Enter Quantity:",3,"data","formGroup","isvalid","formSubmit","formBack",4,"ngIf"],["inputType","number","controlName","quantity","title","Confirm Quantity:",3,"data","formGroup","isvalid","formSubmit","formBack",4,"ngIf"],[2,"height","200px"],["layout","number",3,"inputString","outputString"],["nzClosable","false",3,"nzVisible","nzTitle","nzOkDisabled","nzCancelText","nzStyle","nzVisibleChange","nzOnOk"],["adjustReasonTitleTemplate",""],[4,"nzModalContent"],[3,"auditInfo"],["inputType","number","controlName","quantity","title","Enter Quantity:",3,"data","formGroup","isvalid","formSubmit","formBack"],["inputType","number","controlName","quantity","title","Confirm Quantity:",3,"data","formGroup","isvalid","formSubmit","formBack"],[3,"message","clickSubmit"],[3,"ngModel","ngModelChange"],["nz-radio","",3,"nzValue",4,"ngFor","ngForOf"],["nz-radio","",3,"nzValue"]],template:function(e,r){if(e&1&&(f(0,Ct,2,1,"ng-container",0)(1,ht,2,5,"single-input-form",1)(2,ft,2,5,"single-input-form",2),N(3,"div",3),l(4,"simple-keyboard",4),C("outputString",function(m){return r.onChange(m)}),v(),f(5,Pt,2,1,"ng-container",0)(6,St,2,1,"ng-container",0)(7,At,1,0,"div",0),D(8,"async"),f(9,Nt,1,0,"div",0),D(10,"async"),l(11,"nz-modal",5),C("nzVisibleChange",function(m){return r.reasonsVisible=m})("nzOnOk",function(){return r.onOk()}),f(12,Tt,1,0,"ng-template",null,6,R)(14,Dt,3,2,"ng-container",7),v()),e&2){let o=U(13);s("ngIf",r.auditInfo),a(1),s("ngIf",r.counts.length==0),a(1),s("ngIf",r.counts.length==1),a(2),s("inputString",r.inputForm.value.quantity),a(1),s("ngIf",r.message),a(1),s("ngIf",r.showTimeoutAlert),a(1),s("ngIf",O(8,13,r.info$)),a(2),s("ngIf",O(10,15,r.close$)),a(2),s("nzVisible",r.reasonsVisible)("nzTitle",o)("nzOkDisabled",!r.adjustReason)("nzCancelText",r.cancelText)("nzStyle",z(17,Ot))}},dependencies:[j,J,H,$,mt,it,Y,Z,et,yt,st,ut,ot,W,ct,dt,at,rt,tt,vt,pt],encapsulation:2});let i=u;return i})();export{ne as QuantityAudit};
