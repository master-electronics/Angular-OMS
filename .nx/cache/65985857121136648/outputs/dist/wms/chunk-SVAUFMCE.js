import{a as nt}from"./chunk-4RGKVGHB.js";import{a as rt}from"./chunk-Z6BDTNTK.js";import{a as et}from"./chunk-5VGBK5M2.js";import{k as tt}from"./chunk-EDQ2XWAO.js";import{a as Z}from"./chunk-QTNYEYCW.js";import{a as X}from"./chunk-GKR6SDXW.js";import"./chunk-RMIKNTFD.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import"./chunk-J3DDCTFF.js";import{a as p}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as J}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{e as W}from"./chunk-TREYRKOP.js";import"./chunk-JOHRHLSX.js";import"./chunk-Z347V25R.js";import{E as z,H as Y,I as K,e as j,i as G,t as q}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-WX6KJXZ2.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{c as $}from"./chunk-V5UEWFGK.js";import{a as m}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as V,k as x}from"./chunk-PJEV5NXI.js";import{A as Q,q as w,w as F}from"./chunk-GWV5DZOT.js";import{$b as S,Ba as E,C as d,Da as L,Fb as s,Gb as v,Gc as B,H as g,Ia as D,Ja as R,Lc as T,Mc as O,Q as k,Sb as i,V as A,ac as P,bc as f,cc as _,dc as N,ec as h,f as H,gc as M,na as c,nc as C,pc as y,qa as U}from"./chunk-N7LPRJLK.js";function st(n,o){if(n&1&&(N(0),_(1,"audit-info",2),h()),n&2){let u=y();s(1),i("auditInfo",u.auditInfo)}}function at(n,o){if(n&1){let u=M();N(0),P(1,"popup-modal",3),C("clickSubmit",function(){D(u);let t=y();return R(t.onBack())}),f(),h()}if(n&2){let u=y();s(1),i("message",u.message)}}function dt(n,o){if(n&1){let u=M();N(0),P(1,"popup-modal",3),C("clickSubmit",function(){D(u);let t=y();return R(t.resetTimeout())}),f(),h()}if(n&2){let u=y();s(1),i("message",u.timeoutAlert)}}function ct(n,o){n&1&&_(0,"div")}function mt(n,o){n&1&&_(0,"div")}var kt=(()=>{let o=class o{constructor(e,t,r,a,I){this._fb=e,this._router=t,this._actRoute=r,this._auditService=a,this._eventLog=I,this.userInfo=E(J),this.inputForm=this._fb.nonNullable.group({rohs:["",[j.required]]}),this.options=[{label:"Yes",value:"true"},{label:"No",value:"false"}],this.timeoutSeconds=0}ngOnInit(){if(sessionStorage.getItem("currentAudit")){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.lastUpdated=Number(e.LastUpdated),this.auditInfo={Container:{Barcode:e.Container.Barcode},Inventory:{ITN:e.Inventory.ITN,Product:{PartNumber:e.Inventory.Product.PartNumber,ProductCode:{ProductCodeNumber:e.Inventory.Product.ProductCode.ProductCodeNumber}}}}}this.info$=this._actRoute.data.pipe(g(e=>{this.auditTimeout=e?.Config?.auditTimeout?.data?.fetchConfigValue?.Value,this.alertTime=e?.Config?.alertTime?.data?.fetchConfigValue?.Value;let t=k(1e3);this.subscription=t.subscribe(r=>this.timer())})),this.data$=d(!0)}timer(){++this.timeoutSeconds;let e=(this.lastUpdated+this.auditTimeout*1e3-(this.timeoutSeconds*1e3+this.lastUpdated))/1e3;if(e==0){this._router.navigate(["../../menu"],{relativeTo:this._actRoute});return}e==this.alertTime&&(new rt().beep(100,520),this.showTimeoutAlert=!0);let t=Math.floor(e/60),r=e%60,a=t<10?"0"+t.toString():t.toString(),I=r<10?"0"+r.toString():r.toString();this.timeoutAlert="Audit will timeout in "+a+":"+I}resetTimeout(){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.updateLastUpdated(e.InventoryID,10,new Date(Date.now()).toISOString()).pipe(g(()=>{e.LastUpdated=new Date(Date.now()).getTime().toString(),sessionStorage.setItem("currentAudit",JSON.stringify(e))}),A(t=>d({error:t}))),this.timeoutSeconds=0,this.showTimeoutAlert=!1}onSubmit(){return H(this,null,function*(){let e=this.inputForm.value.rohs,t=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.validateAssignment$(t._id,this.userInfo.userId).pipe(g(r=>{if(r.data.validateAssignment){let a=[{UserEventID:p.Event_IM_ROHS_Entered,UserName:this.userInfo.userName,DistributionCenter:m.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Country of Origin: "+e}],I=[{UserName:this.userInfo.userName,EventTypeID:p.Event_IM_ROHS_Entered,Log:JSON.stringify({DistributionCenter:m.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,ROHSEntered:e,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}];return e!=JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.ROHS&&(a.push({UserEventID:p.Event_IM_ROHS_Updated,UserName:this.userInfo.userName,DistributionCenter:m.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"Original ROHS: "+JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.ROHS+" --- New ROHS: "+e}),I.push({UserName:this.userInfo.userName,EventTypeID:p.Event_IM_ROHS_Updated,Log:JSON.stringify({DistributionCenter:m.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost,NewROHS:e})})),this.data$=this._eventLog.insertLog(a,I).pipe(c(()=>this._auditService.updateLastUpdated(t.InventoryID,50,new Date(Date.now()).toISOString())),c(()=>this._auditService.updateLastUpdated(t.InventoryID,10,new Date(Date.now()).toISOString())),c(l=>this._auditService.inventoryUpdate(this.userInfo.userName,sessionStorage.getItem("auditITN"),"Inventory Management Audit","","","",e)),c(l=>this._auditService.deleteAudit(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,50)),c(l=>this._auditService.nextSubAudit$(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,this.userInfo.userId).pipe(U(b=>{if(b)return this._router.navigate(["../"+b.Route],{relativeTo:this._actRoute}),b;{let ot=[{UserEventID:p.Event_IM_Audit_Completed,UserName:this.userInfo.userName,DistributionCenter:m.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN")}],it=[{UserName:this.userInfo.userName,EventTypeID:p.Event_IM_Audit_Completed,Log:JSON.stringify({DistributionCenter:m.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,ROHSEntered:e,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}];return this.close$=this._eventLog.insertLog(ot,it).pipe(c(pt=>this._auditService.closeAudit(JSON.parse(sessionStorage.getItem("currentAudit")).InventoryID,10,JSON.parse(sessionStorage.getItem("currentAudit")).Inventory.ITN,this.userInfo.userName).pipe(g(ut=>(this._router.navigate(["../verify/scan-itn"],{relativeTo:this._actRoute}),ut))))),d(!0)}}))),A(l=>d({error:{message:l.message,type:"error"}}))),d(!0)}else return this.message="This Audit has timed out!",sessionStorage.removeItem("currentAudit"),sessionStorage.removeItem("auditITN"),d(!0)}))})}onBack(){this._router.navigate(["../scan-itn"],{relativeTo:this._actRoute})}ngOnDestroy(){this.subscription.unsubscribe()}};o.\u0275fac=function(t){return new(t||o)(v(z),v(x),v(V),v(tt),v(Z))},o.\u0275cmp=L({type:o,selectors:[["ng-component"]],standalone:!0,features:[B],decls:9,vars:15,consts:[[4,"ngIf"],["controlName","rohs","title","Select ROHS:",3,"data","formGroup","options","isvalid","formSubmit","formBack"],[3,"auditInfo"],[3,"message","clickSubmit"]],template:function(t,r){t&1&&(S(0,st,2,1,"ng-container",0),P(1,"single-radio-form",1),C("formSubmit",function(){return r.onSubmit()})("formBack",function(){return r.onBack()}),T(2,"async"),f(),S(3,at,2,1,"ng-container",0)(4,dt,2,1,"ng-container",0)(5,ct,1,0,"div",0),T(6,"async"),S(7,mt,1,0,"div",0),T(8,"async")),t&2&&(i("ngIf",r.auditInfo),s(1),i("data",O(2,9,r.data$))("formGroup",r.inputForm)("options",r.options)("isvalid",r.inputForm.valid),s(2),i("ngIf",r.message),s(1),i("ngIf",r.showTimeoutAlert),s(1),i("ngIf",O(6,11,r.info$)),s(2),i("ngIf",O(8,13,r.close$)))},dependencies:[Q,w,F,nt,K,G,q,X,W,$,Y,et],encapsulation:2});let n=o;return n})();export{kt as ROHSAudit};
