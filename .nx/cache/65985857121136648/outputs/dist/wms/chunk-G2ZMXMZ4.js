import{a as Q}from"./chunk-D3GL3SK4.js";import{d as P,e as O,f as b,g as U,h as D}from"./chunk-6TITOEJA.js";import{a as E}from"./chunk-CNRANGED.js";import{a as m}from"./chunk-KSUYRJTQ.js";import{a as C}from"./chunk-YPJKXAYS.js";import{a as i}from"./chunk-I3G2JKLN.js";import{i as S}from"./chunk-LCEARWCQ.js";import{a as T}from"./chunk-4AGTE6D3.js";import{b as k}from"./chunk-5GWOD35Y.js";import{a as p}from"./chunk-PLQ7TNCQ.js";import{Aa as s,Ab as L,Ba as N,H as g,Jb as l,Kb as y,a as o,b as r,na as c,qa as f,va as v,zb as d}from"./chunk-N7LPRJLK.js";var Y=(()=>{let a=class a{constructor(t,e,I,h,n,u,w,j,J,F){this._userC=t,this._move=e,this._verifyBarcode=I,this._noFound=h,this._insertLog=n,this._ItnInUser=u,this._updateInventory=w,this._itn=j,this._userInfo=J,this._log=F,this._destroyRef=N(l),this._sessionStorage=N(k),this._state=L({ITNList:JSON.parse(this._sessionStorage.getItem("stockingItnList")),verifiedItns:JSON.parse(this._sessionStorage.getItem("stockingVerifiedItns")),checkedItns:JSON.parse(this._sessionStorage.getItem("stockingCheckedItns"))}),this.ITNList=d(()=>this._state().ITNList),this.verifiedItns=d(()=>this._state().verifiedItns),this.checkedItns=d(()=>this._state().checkedItns),this.checkedItnsLength=d(()=>this._state().checkedItns?this._state().checkedItns.length:0),y(()=>{this._sessionStorage.setItem("stockingItnList",JSON.stringify(this.ITNList())),this._sessionStorage.setItem("stockingVerifiedItns",JSON.stringify(this.verifiedItns())),this._sessionStorage.setItem("stockingCheckedItns",JSON.stringify(this.checkedItns()))})}ScanItnAsTarget(t){this._state.set({ITNList:[t],verifiedItns:[t],checkedItns:null})}resetVerifiedAndChecked(){this._state.set({ITNList:JSON.parse(this._sessionStorage.getItem("stockingItnList")),verifiedItns:null,checkedItns:null})}moveItnToUser(t){if(!this._userC.userContainerID)throw new Error("Container not found");return this._move.mutate({ITN:t,User:this._userInfo.userName,BinLocation:this._userInfo.userName}).pipe(c(()=>{this._log.initEventLog({UserName:this._userInfo.userName,EventTypeID:i.Event_Stocking_Stocking_MoveITNToUser,Log:JSON.stringify({InventoryTrackingNumber:t,PartNumber:this._itn.itnInfo().PartNumber,ProductCode:this._itn.itnInfo().ProductCode,QuantityOnHand:this._itn.itnInfo().QuantityOnHand,Velocity:this._itn.itnInfo().Velocity})});let e={UserName:this._userInfo.userName,UserEventID:i.Event_Stocking_Stocking_MoveITNToUser,InventoryTrackingNumber:this._itn.itnInfo().ITN,PartNumber:this._itn.itnInfo().PartNumber,ProductCode:this._itn.itnInfo().ProductCode,Message:""};return this._insertLog.mutate({oldLogs:e,eventLogs:this._log.eventLog})}))}findITNsInLocation(t){return this._verifyBarcode.fetch({Barcode:t,DC:p.DistributionCenter},{fetchPolicy:"network-only"}).pipe(f(e=>{if(!e.data.findContainer)throw new Error(`${t} not found!`);if(!e.data.findContainer.ContainerType.IsMobile)throw new Error(`${t} is not a mobile container!`);if(e.data.findContainer.INVENTORies.length===0)throw new Error(`${t} has no ITN!`)}),g(e=>e.data.findContainer.INVENTORies),f(e=>{if(!e.length)throw new Error(`${t} has no vaild ITN!`)}),c(e=>{let I=e.map(n=>(m.devOnly("stockingService","findITNsInLocation",n.InventoryTrackingNumber),{ProductCode:null,PartNumber:null,Remaining:null,ProductType:null,Velocity:null,Autostore:n.Product.Autostore,ITN:n.InventoryTrackingNumber,InventoryID:n._id,ProductID:n.Product._id,QuantityOnHand:n.QuantityOnHand}));m.devOnly("stockingService","findITNsInLocation",I.length),this._state.update(n=>r(o({},n),{ITNList:I}));let h={UserName:this._userInfo.userName,UserEventID:i.Event_Stocking_ScanLocation,Message:t};return this._log.initEventLog({UserName:this._userInfo.userName,EventTypeID:i.Event_Stocking_ScanLocation,Log:JSON.stringify({Source:t})}),this._insertLog.mutate({oldLogs:h,eventLogs:this._log.eventLog})}))}countMatch(){this._state.update(t=>r(o({},t),{verifiedItns:t.ITNList}))}addVerifiedItns(t){if(!this.verifiedItns()?.length){this._state.update(e=>r(o({},e),{verifiedItns:[t]}));return}this.verifiedItns().some(e=>e.ITN===t.ITN)||this._state.update(e=>r(o({},e),{verifiedItns:[...this.verifiedItns(),t]}))}addCheckedItns(t){if(!this.checkedItns()?.length){this._state.update(e=>r(o({},e),{checkedItns:[t]}));return}this.checkedItns().some(e=>e.ITN===t.ITN)||this._state.update(e=>r(o({},e),{checkedItns:[...this.checkedItns(),t]}))}addNotFoundFlag$(t){let e=[],I=[],h=[],n=[];return t.forEach(u=>{e.push({UserName:this._userInfo.userName,UserEventID:i.Event_Stocking_NotFound,InventoryTrackingNumber:u.ITN,Message:""}),I.push(r(o({},this._log.eventLog),{EventTypeID:i.Event_Stocking_NotFound,Log:JSON.stringify(r(o({},JSON.parse(this._log.eventLog.Log)),{InventoryTrackingNumber:u.ITN}))})),h.push(u.ITN),n.push({InventoryID:u.InventoryID,SuspectReasonID:i.SuspectReason_Location})}),this._noFound.mutate({ITNList:h,linkList:n}).pipe(c(()=>this._insertLog.mutate({oldLogs:e,eventLogs:I})))}ItnInUserContainer$(){return this._userC.userContainerID$.pipe(c(t=>this._ItnInUser.fetch({ContainerID:t},{fetchPolicy:"network-only"})),g(t=>t.data.findContainer.INVENTORies))}verifyITN$(t){return this._itn.verifyITN$(t).pipe(c(()=>{let e={UserName:this._userInfo.userName,UserEventID:i.Event_Stocking_ScanITN,InventoryTrackingNumber:t,PartNumber:this._itn.itnInfo().PartNumber,ProductCode:this._itn.itnInfo().ProductCode,Quantity:this._itn.itnInfo().QuantityOnHand,Message:""};return this._log.initEventLog({UserName:this._userInfo.userName,EventTypeID:i.Event_Stocking_ScanITN,Log:JSON.stringify({InventoryTrackingNumber:t,PartNumber:this._itn.itnInfo().PartNumber,ProductCode:this._itn.itnInfo().ProductCode,QuantityOnHand:this._itn.itnInfo().QuantityOnHand,Velocity:this._itn.itnInfo().Velocity})}),this._insertLog.mutate({oldLogs:e,eventLogs:this._log.eventLog})}))}putAway$(){return this._updateInventory.mutate({User:this._userInfo.userName,BinLocation:this._itn.itnInfo().BinLocation,ITN:this._itn.itnInfo().ITN}).pipe(f(()=>{this.addCheckedItns(this._itn.itnInfo())}),c(()=>{let t={UserName:this._userInfo.userName,UserEventID:i.Event_Stocking_StockingRelocation_Location,ProductCode:this._itn.itnInfo().ProductCode,PartNumber:this._itn.itnInfo().PartNumber,Quantity:this._itn.itnInfo().QuantityOnHand,InventoryTrackingNumber:this._itn.itnInfo().ITN,Message:this._itn.itnInfo().BinLocation},e={UserName:this._userInfo.userName,EventTypeID:i.Event_Stocking_StockingRelocation_Location,Log:JSON.stringify({ProductCode:this._itn.itnInfo().ProductCode,PartNumber:this._itn.itnInfo().PartNumber,Quantity:this._itn.itnInfo().QuantityOnHand,InventoryTrackingNumber:this._itn.itnInfo().ITN,Target:this._itn.itnInfo().BinLocation})};return this._insertLog.mutate({oldLogs:t,eventLogs:e})}))}reset(){this._state.set({ITNList:null,verifiedItns:null,checkedItns:null})}};a.\u0275fac=function(e){return new(e||a)(s(E),s(U),s(P),s(D),s(S),s(O),s(b),s(Q),s(T),s(C))},a.\u0275prov=v({token:a,factory:a.\u0275fac});let _=a;return _})();export{Y as a};
