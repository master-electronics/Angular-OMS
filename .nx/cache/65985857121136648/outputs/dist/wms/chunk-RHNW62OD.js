import{a as Oe,b as It,c as gt,d as vt,e as Nt,f as Ct,g as _t,h as yt,i as Tt}from"./chunk-KU2PVJ3V.js";import{a as Ce}from"./chunk-YPJKXAYS.js";import{a as oe,d as Lt}from"./chunk-LNS7FH25.js";import{a as g}from"./chunk-I3G2JKLN.js";import{i as Ne,l as St}from"./chunk-LCEARWCQ.js";import{a as ne,b as re}from"./chunk-RH2D4KR5.js";import{a as de}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import{d as bt,e as Me}from"./chunk-POEXBOQJ.js";import{b as zt}from"./chunk-55MPF5EN.js";import{a as ve,b as ft,d as ht}from"./chunk-MZCJXFXF.js";import{a as Z,b as ee,c as te,d as _e,e as ie}from"./chunk-WUHPQNSG.js";import"./chunk-YGLVR5WL.js";import{a as K,d as Y}from"./chunk-44NJU3LR.js";import"./chunk-Z347V25R.js";import{G as ge,H as X,I as H,d as $,e as z,h as G,i as W,k as pt,m as dt,p as q,t as U,u as J}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import{b as ct}from"./chunk-FMSTYN27.js";import"./chunk-QQPJAVIB.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-WX6KJXZ2.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{a as V,b as j,c as Ie}from"./chunk-V5UEWFGK.js";import{a as _}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import{a as he}from"./chunk-E6LDBMP7.js";import{a as R,c as k,d as fe,e as B,f as Q}from"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{c as pe,i as lt,k as A,n as $e}from"./chunk-PJEV5NXI.js";import{A as ut,o as st,p as De,q as w,w as ce,z as mt}from"./chunk-GWV5DZOT.js";import{$b as v,Ba as ze,C as Te,Da as M,Ea as Ee,Fb as m,Gb as f,Gc as le,H as ae,Hc as Ve,Ia as it,Ja as nt,Jc as ot,Lc as D,Mc as me,N as be,Nc as at,Oc as je,Rc as P,S as Be,Sb as c,Sc as x,Uc as F,V as se,_ as tt,a as T,ac as o,b as S,bc as a,cc as C,g as Ze,gc as rt,j as et,n as ke,na as O,nc as y,pc as b,qa as ue,wa as Le,xc as p,yc as N,zc as Qe}from"./chunk-N7LPRJLK.js";var L=class{constructor(){this._outsetContainer=new ke(null),this.outsetContainer$=this._outsetContainer.asObservable(),this._endContainer=new ke(null)}changeOutsetContainer(t){this._outsetContainer.next(t)}get outsetContainer(){return this._outsetContainer.value}changeEndContainer(t){this._endContainer.next(t)}get endContainer(){return this._endContainer.value}};var At=["containerNumber"];function Rt(e,t){e&1&&C(0,"div")}function kt(e,t){if(e&1&&(o(0,"nz-form-item",2),C(1,"nz-alert",12),a()),e&2){let u=b();m(1),c("nzType",u.alertType==="error"?"error":u.alertType==="success"?"success":u.alertType==="info"?"info":"warning")("nzMessage",u.alertMessage)}}var xe=(()=>{let t=class t{get f(){return this.containerForm.controls}constructor(s,r,n,l,h,d,i,I){this._route=s,this._title=r,this._router=n,this._titleService=l,this._verifyContainer=h,this._insertEventlog=d,this._agInService=i,this._eventLog=I,this.title="Aggregation In",this.isLoading=!1,this.alertType="error",this.alertMessage="",this.query$=new et,this.containerForm=new pt({containerNumber:new dt("",[z.required,z.pattern(ve)])}),this.userInfo=ze(de),this._agInService.changeOutsetContainer(null),this._agInService.changeEndContainer(null),this._title.update(this.title),this._titleService.setTitle("agin")}ngOnInit(){this.alertType=this._route.snapshot.queryParams.type,this.alertMessage=this._route.snapshot.queryParams.message,this._eventLog.initEventLog({UserName:this.userInfo.userName,EventTypeID:g.Event_AgIn_Start,Log:""})}ngAfterViewInit(){this.containerInput.nativeElement.select()}onSubmit(){if(this.alertMessage="",!this.containerForm.valid||this.isLoading){this.containerInput.nativeElement.select();return}this.isLoading=!0;let s=[];this.query$=this._verifyContainer.fetch({DistributionCenter:_.DistributionCenter,Barcode:this.containerForm.value.containerNumber},{fetchPolicy:"network-only"}).pipe(tt(1),ue(r=>{let n=r.data.findContainer;if(!n)throw"Container not found!";if(!n.ContainerType.IsMobile)throw"This container is not mobile!";if(s=r.data.findContainer.INVENTORies.filter(l=>l.ORDERLINEDETAILs.length!==0),s?.length===0)throw"No item in this container!";if(!s.some(l=>l.ORDERLINEDETAILs.length!==0))throw new Error("No order in this container!");if(!s.every((l,h,d)=>l.ORDERLINEDETAILs[0].OrderID===d[0].ORDERLINEDETAILs[0].OrderID&&[60,63].includes(l.ORDERLINEDETAILs[0].StatusID)))throw"Have different order or status in the container.";if(s[0].ORDERLINEDETAILs[0]?.StatusID<g.qcComplete_ID||s[0].ORDERLINEDETAILs[0]?.StatusID>=g.agOutComplete_ID)throw"OrderLine's status is invalid."}),O(r=>{let n=r.data.findContainer,l=[],h=[],d={toteID:n._id,Barcode:n.Barcode,OrderID:s[0].ORDERLINEDETAILs[0].OrderID,OrderNumber:s[0].ORDERLINEDETAILs[0].Order.OrderNumber,NOSINumber:s[0].ORDERLINEDETAILs[0].Order.NOSINumber,CustomerNumber:s[0].ORDERLINEDETAILs[0].Order.Customer?.CustomerNumber,CustomerTier:s[0].ORDERLINEDETAILs[0].Order.Customer?.CustomerTier,ShipmentMethod:s[0].ORDERLINEDETAILs[0].Order.ShipmentMethod?._id,ShipmentMethodDescription:s[0].ORDERLINEDETAILs[0].Order.ShipmentMethod?.ShippingMethod,Priority:s[0].ORDERLINEDETAILs[0].Order.ShipmentMethod?.PriorityPinkPaper,ITNsInTote:[],isRelocation:s[0].ORDERLINEDETAILs[0].StatusID===g.agInComplete_ID};return s.forEach(i=>{if(i.InventoryTrackingNumber){let I=i.ORDERLINEDETAILs[0];d.ITNsInTote.push({detaileID:i.ORDERLINEDETAILs[0]._id,InventoryID:i._id,ITN:i.InventoryTrackingNumber,OrderLineNumber:I.OrderLine.OrderLineNumber,PartNumber:i.Product?.PartNumber,ProductCode:i.Product?.ProductCode.ProductCodeNumber,ProductTier:i.Product?.ProductTier,WMSPriority:I.WMSPriority,ParentITN:i.ParentITN,Quantity:I.Quantity})}}),this._eventLog.updateEventLog(S(T({},this._eventLog.eventLog),{Log:JSON.stringify({OrderNumber:d.OrderNumber,NOSINumber:d.NOSINumber,CustomerNumber:d.CustomerNumber,CustomerTier:d.CustomerTier,DistributionCenter:_.DistributionCenter,ShipmentMethod:d.ShipmentMethod,ShipmentMethodDescription:d.ShipmentMethodDescription,Priority:d.Priority,Message:`Start ${n.Barcode}`})})),d.ITNsInTote.forEach(i=>{l.push({UserName:this.userInfo.userName,OrderNumber:d.OrderNumber,NOSINumber:d.NOSINumber,OrderLineNumber:i.OrderLineNumber,InventoryTrackingNumber:i.ITN,UserEventID:g.Event_AgIn_Start,Message:`Start ${n.Barcode}`,CustomerNumber:d.CustomerNumber,CustomerTier:d.CustomerTier,DistributionCenter:_.DistributionCenter,PartNumber:i.PartNumber,ProductCode:i.ProductCode,ProductTier:i.ProductTier,Quantity:i.Quantity,ParentITN:i.ParentITN,ShipmentMethod:d.ShipmentMethod,ShipmentMethodDescription:d.ShipmentMethodDescription,Priority:d.Priority,WMSPriority:i.WMSPriority}),h.push(S(T({},this._eventLog.eventLog),{Log:JSON.stringify(S(T({},JSON.parse(this._eventLog.eventLog.Log)),{OrderLineNumber:i.OrderLineNumber,InventoryTrackingNumber:i.ITN,PartNumber:i.PartNumber,ProductCode:i.ProductCode,ProductTier:i.ProductTier,Quantity:i.Quantity,ParentITN:i.ParentITN,WMSPriority:i.WMSPriority}))}))}),this._agInService.changeOutsetContainer(d),this._insertEventlog.mutate({oldLogs:l,eventLogs:h})}),ae(()=>(this.isLoading=!1,this._router.navigate(["agin/location"]),!0)),se(r=>(this.alertMessage=r,this.alertType="error",this.isLoading=!1,[])))}};t.\u0275fac=function(r){return new(r||t)(f(lt),f(he),f(A),f(pe),f(Oe),f(Ne),f(L),f(Ce))},t.\u0275cmp=M({type:t,selectors:[["aggregation-in"]],viewQuery:function(r,n){if(r&1&&x(At,5),r&2){let l;P(l=F())&&(n.containerInput=l.first)}},decls:17,vars:6,consts:[[1,"container","mx-auto","px-2","py-2","md:mt-4"],["nz-form","","focusInvalidInput","",3,"formGroup","ngSubmit"],["nz-row","","nzJustify","center"],["nz-col","","nzXs","20","nzSm","16","nzMd","12","nzLg","10","nzXl","8","nzXXl","6"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","The input is not valid container!"],["nz-input","","placeholder","Barcode: 50-01-01","nzSize","large","type","text","id","containerNumber","formControlName","containerNumber","autocomplete","off"],["containerNumber",""],[4,"ngIf"],["nz-col","","nzSpan","13"],["nz-button","","type","submit","nzType","primary","nzSize","large",1,"w-full",3,"nzLoading","click"],["nz-row","","nzJustify","center",4,"ngIf"],["nzShowIcon","",1,"w-full",3,"nzType","nzMessage"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"form",1),y("ngSubmit",function(){return n.onSubmit()}),o(2,"div",2)(3,"div",3)(4,"nz-form-item",2)(5,"nz-form-label",4),p(6," Container "),a(),o(7,"nz-form-control",5),C(8,"input",6,7),a()(),v(10,Rt,1,0,"div",8),D(11,"async"),o(12,"nz-form-item",2)(13,"div",9)(14,"button",10),y("click",function(){return n.onSubmit()}),p(15," Submit "),a()()(),v(16,kt,2,2,"nz-form-item",11),a()()()()),r&2&&(m(1),c("formGroup",n.containerForm),m(9),c("ngIf",me(11,4,n.query$)),m(4),c("nzLoading",n.isLoading),m(2),c("ngIf",n.alertMessage))},dependencies:[w,q,$,G,W,U,J,K,B,R,k,j,V,ee,Z,_e,te,ne,oe,ce],encapsulation:2});let e=t;return e})();var Bt=["location"],xt=()=>({rows:2});function Qt(e,t){e&1&&C(0,"nz-skeleton",16),e&2&&c("nzActive",!0)("nzParagraph",Ve(2,xt))}function Vt(e,t){e&1&&(o(0,"div",21),p(1,"Locations:"),a())}function jt(e,t){e&1&&(o(0,"div",21),p(1,"First Tote"),a())}function $t(e,t){if(e&1&&(o(0,"li")(1,"span"),p(2),a(),o(3,"span"),p(4,"-"),a(),o(5,"span"),p(6),a(),o(7,"span"),p(8,"-"),a(),o(9,"span"),p(10),a(),o(11,"span"),p(12,"-"),a(),o(13,"span"),p(14),a(),o(15,"span"),p(16,"-"),a(),o(17,"span"),p(18),a(),o(19,"span"),p(20,"-"),a(),o(21,"span"),p(22),a(),o(23,"span",22),p(24),a()()),e&2){let u=t.$implicit;m(2),N(u.substring(0,2)),m(4),N(u.substring(2,4)),m(4),N(u.substring(4,6)),m(4),N(u.substring(6,8)),m(4),N(u.substring(8,9)),m(4),N(u.substring(9,11)),m(2),Qe("(",u.substring(11),")")}}function Gt(e,t){e&1&&(o(0,"li",21),p(1,"---"),a())}function Wt(e,t){e&1&&(o(0,"li",21),p(1,"---"),a())}function qt(e,t){e&1&&(o(0,"li",21),p(1,"---"),a())}function Ut(e,t){if(e&1&&(o(0,"div",17),v(1,Vt,2,0,"div",18)(2,jt,2,0,"div",18),o(3,"ul",19),v(4,$t,25,7,"li",20),D(5,"slice"),v(6,Gt,2,0,"li",18)(7,Wt,2,0,"li",18)(8,qt,2,0,"li",18),a()()),e&2){let u=b();m(1),c("ngIf",u.locationList.length),m(1),c("ngIf",!u.locationList.length),m(2),c("ngForOf",je(5,6,u.locationList,0,3)),m(2),c("ngIf",!u.locationList[0]),m(1),c("ngIf",!u.locationList[1]),m(1),c("ngIf",!u.locationList[2])}}function Jt(e,t){if(e&1){let u=rt();o(0,"button",23),y("click",function(){it(u);let r=b();return nt(r.toggleNewLocation())}),p(1," New "),a()}}function Xt(e,t){if(e&1&&(o(0,"nz-form-item",1),C(1,"nz-alert",24),a()),e&2){let u=b();m(1),c("nzType",u.alertType==="error"?"error":u.alertType==="success"?"success":u.alertType==="info"?"info":"warning")("nzMessage",u.alertMessage)}}function Ht(e,t){e&1&&C(0,"nz-skeleton",16),e&2&&c("nzActive",!0)("nzParagraph",Ve(2,xt))}var Kt=(e,t)=>({"text-red-500":e,"text-blue-600":t});function Yt(e,t){if(e&1&&(o(0,"div")(1,"div",28)(2,"span",29),p(3),a(),o(4,"span",30),p(5),a()()()),e&2){let u=t.$implicit;m(3),N(u[0]),m(1),c("ngClass",ot(3,Kt,u[1]==="Yes",u[1]!=="Yes")),m(1),N(u[1])}}function Zt(e,t){if(e&1&&(o(0,"div",31)(1,"span",32),p(2),a(),o(3,"span",33),p(4),a()()),e&2){let u=t.$implicit;m(2),N(u[0]),m(2),N(u[1])}}function ei(e,t){if(e&1&&(o(0,"div",25)(1,"div",26),v(2,Yt,6,6,"div",20),D(3,"slice"),a(),v(4,Zt,5,2,"div",27),D(5,"slice"),a()),e&2){let u=b();m(2),c("ngForOf",je(3,2,u.ITNInfo,0,6)),m(2),c("ngForOf",at(5,6,u.ITNInfo,6))}}var Fe=(()=>{let t=class t{regex(s){return ht.test(s.value)||ve.test(s.value)||s.value===""?null:{regex:{valid:!1}}}get f(){return this.locationForm.controls}constructor(s,r,n,l,h,d,i,I,E,ye,Re,wt){this._fb=s,this._title=r,this._titleService=n,this._router=l,this._fetchLocation=h,this._updateAfterAgOut=d,this._fetchHazard=i,this._verifyContainer=I,this._countOrderItns=E,this._agInService=ye,this._insertLog=Re,this._eventLog=wt,this.FileKeyListforAgIn=[],this.isLoading=!1,this.newLocation=!1,this.buttonLabel="Relocate",this.ITNInfo=[],this.alertMessage="",this.alertType="error",this.isLastLine=!1,this.locationForm=this._fb.group({location:["",[z.required,this.regex]]}),this.subscription=new Ze,this.userInfo=ze(de),this._titleService.setTitle("agin/location")}ngOnInit(){if(this.outsetContainer=this._agInService.outsetContainer,!this.outsetContainer){this._router.navigate(["agin"]);return}this._agInService.changeEndContainer(null),this._title.update(`AGIN: ${this.outsetContainer.Barcode}`),this.isLoading=!0;let s=[],r=[],n="";this.initInfo$=this._fetchLocation.fetch({OrderID:this.outsetContainer.OrderID},{fetchPolicy:"network-only"}).pipe(Be(l=>{let h=new Set,d=0,i=0;return l.data.findOrderLineDetails.forEach(I=>{if(++d,I.Inventory){n=I.Inventory.InventoryTrackingNumber,this.OrderNumber=this.outsetContainer.OrderNumber,this.NOSINumber=this.outsetContainer.NOSINumber,s.push(`${_.DistributionCenter}${this.OrderNumber}${this.NOSINumber}${this.outsetContainer.ITNsInTote[0].OrderLineNumber}ag             ${I.Inventory.InventoryTrackingNumber}`),I.Inventory.Container.Row==="AG"&&h.add(I.Inventory.Container.Warehouse.concat(I.Inventory.Container.Row,I.Inventory.Container.Aisle,I.Inventory.Container.Section,I.Inventory.Container.Shelf,I.Inventory.Container.ShelfDetail,I.Inventory.Container.Barcode));let E=this.outsetContainer.ITNsInTote.findIndex(ye=>I._id===ye.detaileID);if(E>=0){this.ITNInfo=[["Order#",this.OrderNumber],["Priority",this.outsetContainer.Priority?"No":"Yes"],["Customer",this.outsetContainer.CustomerNumber],["Quantity",I.Quantity],["ITN Count",""],["PRC",this.outsetContainer.ITNsInTote[E].ProductCode],["PartNumber",this.outsetContainer.ITNsInTote[E].PartNumber],["Shipment",this.outsetContainer.ShipmentMethodDescription]],this.FileKeyListforAgIn.push(`${_.DistributionCenter}${this.OrderNumber}${this.NOSINumber}${this.outsetContainer.ITNsInTote[E].OrderLineNumber}ag             ${I.Inventory.InventoryTrackingNumber}`),r.push(`${this.outsetContainer.ITNsInTote[E].ProductCode.padEnd(3)}${this.outsetContainer.ITNsInTote[E].PartNumber}`),++i;return}I.StatusID>=g.agInComplete_ID&&++i}}),this.ITNInfo[4][1]=`${i} of ${d}`,h.size===0&&(this.newLocation=!0,this.buttonLabel="New Location"),this.outsetContainer.isRelocation&&(this.newLocation=!0,this.buttonLabel="Relocate",this.ITNInfo=[]),this.isLastLine=i===d,this.locationList=[...h],d===1?!0:(this.isLoading=!1,!1)}),O(()=>this._countOrderItns.fetch({LocationCode:_.DistributionCenter,OrderNumber:this.OrderNumber,NOSINumber:this.NOSINumber},{fetchPolicy:"network-only"})),Be(l=>l.data.countOrderItns===1?!0:(this.isLoading=!1,!1)),O(()=>be({updateOrder:this._updateAfterAgOut.mutate({OrderID:Number(this.outsetContainer.OrderID),OrderLineDetail:{StatusID:g.agOutComplete_ID},DistributionCenter:_.DistributionCenter,toteList:[this.outsetContainer.Barcode],OrderNumber:this.OrderNumber,NOSINumber:this.NOSINumber,UserOrStatus:"Packing",MerpStatus:String(g.agOutComplete_ID),FileKeyList:s,ActionType:"A",Action:"line_aggregation_out",ITNList:[{ITN:n,BinLocation:"PACKING",User:this.userInfo.userName}]}),checkHazmzd:this._fetchHazard.fetch({ProductList:r},{fetchPolicy:"network-only"})})),O(l=>{let h=[{UserName:this.userInfo.userName,OrderNumber:this.OrderNumber,NOSINumber:this.NOSINumber,InventoryTrackingNumber:n,UserEventID:g.Event_AgIn_SingleITNAgOut,Message:`Single ITN Ag out ${this.outsetContainer.Barcode}`,CustomerNumber:this.outsetContainer.CustomerNumber,CustomerTier:this.outsetContainer.CustomerTier,DistributionCenter:_.DistributionCenter,OrderLineNumber:this.outsetContainer.ITNsInTote[0].OrderLineNumber,PartNumber:this.outsetContainer.ITNsInTote[0].PartNumber,ProductCode:this.outsetContainer.ITNsInTote[0].ProductCode,ProductTier:this.outsetContainer.ITNsInTote[0].ProductTier,Quantity:this.outsetContainer.ITNsInTote[0].Quantity,ParentITN:this.outsetContainer.ITNsInTote[0].ParentITN,ShipmentMethod:this.outsetContainer.ShipmentMethod,ShipmentMethodDescription:this.outsetContainer.ShipmentMethodDescription,Priority:this.outsetContainer.Priority,WMSPriority:this.outsetContainer.ITNsInTote[0].WMSPriority}],d=S(T({},this._eventLog.eventLog),{EventTypeID:g.Event_AgIn_SingleITNAgOut,Log:JSON.stringify(S(T({},JSON.parse(this._eventLog.eventLog.Log)),{InventoryTrackingNumber:n,OrderLineNumber:this.outsetContainer.ITNsInTote[0].OrderLineNumber,PartNumber:this.outsetContainer.ITNsInTote[0].PartNumber,ProductCode:this.outsetContainer.ITNsInTote[0].ProductCode,ProductTier:this.outsetContainer.ITNsInTote[0].ProductTier,Quantity:this.outsetContainer.ITNsInTote[0].Quantity,ParentITN:this.outsetContainer.ITNsInTote[0].ParentITN,WMSPriority:this.outsetContainer.ITNsInTote[0].WMSPriority,Message:`Single ITN Ag out ${this.outsetContainer.Barcode}`}))});return this.type="success",this.message=`Order complete ${this.OrderNumber}-${this.NOSINumber}`,l.checkHazmzd.data.fetchProductInfoFromMerp.some(i=>/^[\w]+$/.test(i.HazardMaterialLevel.trim())&&i.HazardMaterialLevel.trim()!=="N")&&(this.type="warning",this.message+=`
This order contains hazardous materials`),this._insertLog.mutate({oldLogs:h,eventLogs:d})}),ae(()=>(this.isLoading=!1,this._router.navigate(["agin"],{queryParams:{type:this.type,message:this.message}}),!0)),se(l=>(this.alertMessage=l,this.isLoading=!1,this.locationInput.nativeElement.select(),Te(!1))))}ngAfterViewInit(){this.locationInput.nativeElement.focus()}toggleNewLocation(){this.newLocation=!0,this.buttonLabel="New Location",this.locationInput.nativeElement.select()}onSubmit(){if(this.alertMessage="",!this.locationForm.valid||this.isLoading)return;let s=this.f.location.value,r=s.length===8?s:s.replace(/-/g,""),n=s.length===8?"tote":"shelf";if(this.outsetContainer.Barcode===r){this.alertMessage="Should scan a new Container",this.alertType="warning",this.locationInput.nativeElement.select();return}if(!this.newLocation&&r.length>8&&!this.locationList.some(h=>h.substring(0,11)===r)){this.alertMessage="This container is a new location",this.alertType="error",this.locationInput.nativeElement.select();return}this.isLoading=!0,this.verifyContainer$=this._verifyContainer.fetch({Barcode:r,DistributionCenter:_.DistributionCenter},{fetchPolicy:"network-only"}).pipe(ue(l=>{let h=l.data.findContainer;if(!h)throw"Can not find this container";if(![g.toteType_ID,g.shelfType_ID].includes(h.ContainerTypeID))throw"This container should be tote or shelf";if(h.Row!=="AG")throw"This container is not in Aggregation area";let d=l.data.findContainer.INVENTORies.filter(i=>i.ORDERLINEDETAILs.length!==0);h.ContainerType.IsMobile&&d.forEach(i=>{if(i.ORDERLINEDETAILs[0].OrderID!==this.outsetContainer.OrderID)throw"This container has other order in it."})}),ae(l=>{let h=l.data.findContainer,d={Barcode:s,type:n,isLastLine:this.isLastLine,location:{Warehouse:h.Warehouse,Row:h.Row,Aisle:h.Aisle,Section:h.Section,Shelf:h.Shelf,ShelfDetail:h.ShelfDetail},OrderNumber:this.OrderNumber,NOSINumber:this.NOSINumber,containerID:h._id,FileKeyListforAgIn:this.FileKeyListforAgIn};return this._agInService.changeEndContainer(d),this._router.navigate(["agin/verifytote"]),!0}),se(l=>(this.alertMessage=l,this.isLoading=!1,this.locationInput.nativeElement.select(),Te(!1))))}ngOnDestroy(){this.subscription.unsubscribe()}};t.\u0275fac=function(r){return new(r||t)(f(ge),f(he),f(pe),f(A),f(It),f(Nt),f(vt),f(Oe),f(gt),f(L),f(Ne),f(Ce))},t.\u0275cmp=M({type:t,selectors:[["location"]],viewQuery:function(r,n){if(r&1&&x(Bt,5),r&2){let l;P(l=F())&&(n.locationInput=l.first)}},standalone:!0,features:[le],decls:25,vars:16,consts:[[1,"container","mx-auto","px-2","md:mt-4"],["nz-row","","nzJustify","center"],["nz-col","","nzXs","20","nzSm","16","nzMd","12","nzLg","10","nzXl","8","nzXXl","6"],[3,"nzActive","nzParagraph",4,"ngIf"],["nz-row","",4,"ngIf"],["nz-form","","focusInvalidInput","",3,"formGroup","ngSubmit"],["nzHasFeedback","","nzErrorTip","The input is not valid container!"],["nz-input","","oninput","this.value = this.value.toUpperCase()","placeholder","To:","nzSize","large","type","text","id","location","formControlName","location","autocomplete","off"],["location",""],["nz-row","","nzGutter","16","nzJustify","center"],["nz-col","","nzSpan","16"],["nz-button","","type","submit","nzType","primary","nzSize","large",1,"w-full",3,"nzLoading","disabled","click"],["nz-col","","nzSpan","8"],["nz-button","","type","button","nzSize","large","class","w-full",3,"click",4,"ngIf"],["nz-row","","nzJustify","center",4,"ngIf"],["class","mt-2 md:mt-6",4,"ngIf"],[3,"nzActive","nzParagraph"],["nz-row",""],["nz-col","","nzSpan","24",4,"ngIf"],[1,"text-lg","font-bold","text-yellow-600"],[4,"ngFor","ngForOf"],["nz-col","","nzSpan","24"],[1,"text-blue-500"],["nz-button","","type","button","nzSize","large",1,"w-full",3,"click"],["nzShowIcon","",1,"w-full",3,"nzType","nzMessage"],[1,"mt-2","md:mt-6"],[1,"grid","grid-cols-2","text-black"],["class","grid grid-cols-4 text-black",4,"ngFor","ngForOf"],[1,"grid","grid-cols-2","gap-2"],[1,"self-center","justify-self-end","text-xs"],[1,"font-semibold",3,"ngClass"],[1,"grid","grid-cols-4","text-black"],[1,"mr-1","self-center","justify-self-end","text-xs"],[1,"col-span-3","ml-1","font-semibold","text-blue-600"]],template:function(r,n){r&1&&(o(0,"div"),p(1),D(2,"async"),a(),o(3,"div"),p(4),D(5,"async"),a(),o(6,"div",0)(7,"div",1)(8,"div",2),v(9,Qt,1,3,"nz-skeleton",3)(10,Ut,9,10,"div",4),o(11,"form",5),y("ngSubmit",function(){return n.onSubmit()}),o(12,"nz-form-item",1)(13,"nz-form-control",6),C(14,"input",7,8),a()(),o(16,"nz-form-item",9)(17,"div",10)(18,"button",11),y("click",function(){return n.onSubmit()}),p(19),a()(),o(20,"div",12),v(21,Jt,2,0,"button",13),a()(),v(22,Xt,2,2,"nz-form-item",14),a(),v(23,Ht,1,3,"nz-skeleton",3)(24,ei,6,9,"div",15),a()()()),r&2&&(m(1),N(me(2,12,n.initInfo$)),m(3),N(me(5,14,n.verifyContainer$)),m(5),c("ngIf",!n.locationList),m(1),c("ngIf",n.locationList),m(1),c("formGroup",n.locationForm),m(7),c("nzLoading",n.isLoading)("disabled",n.isLoading),m(1),Qe(" ",n.buttonLabel," "),m(2),c("ngIf",!n.newLocation),m(1),c("ngIf",n.alertMessage),m(1),c("ngIf",!n.locationList),m(1),c("ngIf",!n.outsetContainer.isRelocation))},dependencies:[Ie,j,V,w,Me,bt,De,X,q,$,G,W,ie,ee,Z,te,oe,H,U,J,Y,K,Q,B,R,k,fe,re,ne,st,ce,mt],encapsulation:2});let e=t;return e})();var ti=["containerNumber"];function ii(e,t){e&1&&C(0,"div")}function ni(e,t){if(e&1&&(o(0,"nz-form-item",3),C(1,"nz-alert",16),a()),e&2){let u=b();m(1),c("nzType",u.alertType==="error"?"error":u.alertType==="success"?"success":u.alertType==="info"?"info":"warning")("nzMessage",u.alertMessage)}}function ri(e,t){if(e&1&&(o(0,"tr",17)(1,"td",18),p(2),a()()),e&2){let u=t.$implicit;m(2),N(u)}}function oi(e,t){if(e&1&&(o(0,"tr",19)(1,"td"),p(2),a()()),e&2){let u=t.$implicit;m(2),N(u)}}var we=(()=>{let t=class t{constructor(s,r,n,l,h,d,i,I,E,ye,Re){this._fb=s,this._router=r,this._agInService=n,this._updatelocation=l,this._updateBin=h,this._updateStatus=d,this._updateMerpLog=i,this._updateMerpOrder=I,this._insertEventLog=E,this._eventLog=ye,this._userInfo=Re,this.alertType="error",this.alertMessage="",this.isLoading=!1,this.totalITNs=0,this.itemList=[],this.selectedList=[],this.containerForm=this._fb.group({containerNumber:["",[z.required,z.pattern(ft)]]})}ngOnInit(){if(this.endContainer=this._agInService.endContainer,this.outsetContainer=this._agInService.outsetContainer,!this.endContainer||!this.outsetContainer){this._router.navigate(["agin"]);return}this.itemList=this.outsetContainer.ITNsInTote.map(s=>s.ITN),this.totalITNs=this.itemList.length}ngAfterViewInit(){this.containerInput.nativeElement.select()}onSubmit(){if(this.alertMessage="",this.containerForm.invalid||this.isLoading){this.containerInput.nativeElement.select();return}this.selectITN()}selectITN(){let s=0;this.itemList=this.itemList.filter(r=>{let n=r===this.containerForm.get("containerNumber").value;return n&&(this.selectedList.unshift(r),s+=1),!n}),this.totalITNs===this.selectedList.length?this.updateForAgIn():s===0&&(this.alertMessage="ITN is not in the list."),this.containerForm.reset({containerNumber:""}),this.containerInput.nativeElement.select()}updateForAgIn(){let s=this._agInService.outsetContainer.ITNsInTote.map(i=>({User:this._userInfo.userName,ITN:i.ITN,BinLocation:this._agInService.endContainer.Barcode})),r={updateContainer:this._updateBin.mutate({ITNList:s}),updateStatus:this._updateStatus.mutate({StatusID:g.agInComplete_ID,InventoryIDList:this._agInService.outsetContainer.ITNsInTote.map(i=>i.InventoryID)})},n={Warehouse:null,Row:null,Aisle:null,Section:null,Shelf:null,ShelfDetail:null};this.endContainer.type==="shelf"&&(n={Warehouse:this.endContainer.location.Warehouse,Row:this.endContainer.location.Row,Aisle:this.endContainer.location.Aisle,Section:this.endContainer.location.Section,Shelf:this.endContainer.location.Shelf,ShelfDetail:this.endContainer.location.ShelfDetail},delete r.updateContainer);let l={ContainerID:Number(this.outsetContainer.toteID),Container:n},h=this.outsetContainer.ITNsInTote.map(i=>({UserName:this._userInfo.userName,OrderNumber:this.endContainer.OrderNumber,NOSINumber:this.endContainer.NOSINumber,UserEventID:g.Event_AgIn_Relocate,InventoryTrackingNumber:i.ITN,OrderLineNumber:i.OrderLineNumber,Message:`Relocate ${this.outsetContainer.Barcode} to ${this.endContainer.Barcode}`,CustomerNumber:this.outsetContainer.CustomerNumber,CustomerTier:this.outsetContainer.CustomerTier,DistributionCenter:_.DistributionCenter,PartNumber:i.PartNumber,ProductCode:i.ProductCode,ProductTier:i.ProductTier,Quantity:i.Quantity,ParentITN:i.ParentITN,ShipmentMethod:this.outsetContainer.ShipmentMethod,ShipmentMethodDescription:this.outsetContainer.ShipmentMethodDescription,Priority:this.outsetContainer.Priority,WMSPriority:i.WMSPriority})),d=this.outsetContainer.ITNsInTote.map(i=>S(T({},this._eventLog.eventLog),{EventTypeID:g.Event_AgIn_Relocate,Log:JSON.stringify(S(T({},JSON.parse(this._eventLog.eventLog.Log)),{InventoryTrackingNumber:i.ITN,OrderLineNumber:i.OrderLineNumber,Message:`Relocate ${this.outsetContainer.Barcode} to ${this.endContainer.Barcode}`,PartNumber:i.PartNumber,ProductCode:i.ProductCode,ProductTier:i.ProductTier,Quantity:i.Quantity,ParentITN:i.ParentITN,WMSPriority:i.WMSPriority}))}));this.outsetContainer.isRelocation||(h.forEach(i=>{i.Message=i.Message.substring(9),i.UserEventID=g.Event_AgIn_Done}),d.forEach(i=>{i.EventTypeID=g.Event_AgIn_Done;let I=JSON.parse(i.Log).Message;i.Log=JSON.stringify(S(T({},JSON.parse(i.Log)),{Message:I.substring(9)}))}),r.updateMerpLog=this._updateMerpLog.mutate({DistributionCenter:_.DistributionCenter,FileKeyList:this.endContainer.FileKeyListforAgIn,ActionType:"A",Action:"line_aggregation_in"}),this.endContainer.isLastLine&&(h.push({UserName:this._userInfo.userName,OrderNumber:this.endContainer.OrderNumber,NOSINumber:this.endContainer.NOSINumber,UserEventID:g.Event_AgIn_OrderComplete,InventoryTrackingNumber:null,OrderLineNumber:null,Message:null,CustomerNumber:this.outsetContainer.CustomerNumber,CustomerTier:this.outsetContainer.CustomerTier,DistributionCenter:_.DistributionCenter,PartNumber:null,ProductCode:null,ProductTier:null,Quantity:null,ParentITN:null,ShipmentMethod:this.outsetContainer.ShipmentMethod,ShipmentMethodDescription:this.outsetContainer.ShipmentMethodDescription,WMSPriority:null,Priority:this.outsetContainer.Priority}),d.push(S(T({},this._eventLog.eventLog),{EventTypeID:g.Event_AgIn_OrderComplete})),r.updateMerpOrder=this._updateMerpOrder.mutate({OrderNumber:this.endContainer.OrderNumber,NOSINumber:this.endContainer.NOSINumber,Status:String(g.agInComplete_ID),UserOrStatus:"AGGREGATION-OUT"}))),r.updateSql=this._updatelocation.mutate(l),this.isLoading=!0,this.updateAfterAgIn$=be(r).pipe(ue(i=>{let I;if(i.updateStatus.data.updateOrderLineDetailList.length||(I+=`
Fail to update order Status.`),i.updateSql.data.updateContainer.length||(I+=`
Fail to update SQL Container.`),I)throw`${this.endContainer.OrderNumber}-${this.endContainer.NOSINumber}`.concat(I)}),O(()=>this._insertEventLog.mutate({oldLogs:h,eventLogs:d})),ae(()=>(this._router.navigate(["agin"],{queryParams:{type:"info",message:`${this.outsetContainer.Barcode} place in ${this.endContainer.Barcode}.`}}),1)),se(i=>(this.alertMessage=i,this.alertType="error",this.isLoading=!1,this.containerInput.nativeElement.select(),Te(0))))}};t.\u0275fac=function(r){return new(r||t)(f(ge),f(A),f(L),f(_t),f(St),f(Ct),f(yt),f(Tt),f(Ne),f(Ce),f(de))},t.\u0275cmp=M({type:t,selectors:[["verify-itn"]],viewQuery:function(r,n){if(r&1&&x(ti,5),r&2){let l;P(l=F())&&(n.containerInput=l.first)}},standalone:!0,features:[le],decls:24,vars:9,consts:[[4,"ngIf"],[1,"container","mx-auto","px-2","py-2","md:mt-4"],["nz-form","","focusInvalidInput","",3,"formGroup","ngSubmit"],["nz-row","","nzJustify","center"],["nz-col","","nzXs","20","nzSm","16","nzMd","12","nzLg","10","nzXl","8","nzXXl","6"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","The input is not valid ITN!"],["nz-input","","placeholder"," ","formControlName","containerNumber","placeholder","ITN#","nzSize","large","type","text","id","containerNumber","name","containerNumber","autocomplete","off"],["containerNumber",""],["nz-col","","nzSpan","13"],["nz-button","","type","submit","nzType","primary","nzSize","large",1,"w-full",3,"nzLoading","disabled","click"],["nz-row","","nzJustify","center",4,"ngIf"],[1,"w-full"],[1,"grid","grid-cols-3","justify-items-start","gap-3"],["class","text-lg",4,"ngFor","ngForOf"],["class","text-lg text-green-500",4,"ngFor","ngForOf"],["nzShowIcon","",1,"w-full",3,"nzType","nzMessage"],[1,"text-lg"],[1,"select-none"],[1,"text-lg","text-green-500"]],template:function(r,n){r&1&&(v(0,ii,1,0,"div",0),D(1,"async"),o(2,"div",1)(3,"form",2),y("ngSubmit",function(){return n.onSubmit()}),o(4,"div",3)(5,"div",4)(6,"nz-form-item",3)(7,"nz-form-label",5),p(8,"Scan ITNs in the tote"),a(),o(9,"nz-form-control",6),C(10,"input",7,8),a()(),o(12,"nz-form-item",3)(13,"div",9)(14,"button",10),y("click",function(){return n.onSubmit()}),p(15," Submit "),a()()(),v(16,ni,2,2,"nz-form-item",11),o(17,"table",12)(18,"thead",13)(19,"th"),p(20,"ITN"),a()(),o(21,"tbody"),v(22,ri,3,1,"tr",14)(23,oi,3,1,"tr",15),a()()()()()()),r&2&&(c("ngIf",me(1,7,n.updateAfterAgIn$)),m(3),c("formGroup",n.containerForm),m(11),c("nzLoading",n.isLoading)("disabled",n.isLoading),m(2),c("ngIf",n.alertMessage),m(6),c("ngForOf",n.itemList),m(1),c("ngForOf",n.selectedList))},dependencies:[w,X,q,$,G,W,ie,j,V,ee,Z,_e,te,oe,H,U,J,Ie,Y,K,Q,B,R,k,fe,re,ne,De,ce],encapsulation:2});let e=t;return e})();var ai=["container"];function si(e,t){e&1&&(o(0,"p",16),p(1," Place to Shelf "),a())}function mi(e,t){e&1&&(o(0,"p",16),p(1," Conbine into another tote "),a())}function ui(e,t){e&1&&(o(0,"p",14),p(1," Scan the start tote "),a())}function li(e,t){e&1&&(o(0,"p",14),p(1," Scan the end tote again "),a())}function ci(e,t){if(e&1&&(o(0,"div",12),v(1,si,2,0,"p",13)(2,mi,2,0,"p",13),o(3,"p",14),p(4),a(),v(5,ui,2,0,"p",15)(6,li,2,0,"p",15),a()),e&2){let u=b();m(1),c("ngIf",u.endContainer.type==="shelf"),m(1),c("ngIf",u.endContainer.type==="tote"),m(2),N(u.endContainer.Barcode),m(1),c("ngIf",u.endContainer.type==="shelf"),m(1),c("ngIf",u.endContainer.type==="tote")}}function pi(e,t){if(e&1&&(o(0,"nz-form-item",2),C(1,"nz-alert",17),a()),e&2){let u=b();m(1),c("nzType",u.alertType==="error"?"error":u.alertType==="success"?"success":u.alertType==="info"?"info":"warning")("nzMessage",u.alertMessage)}}var Ae=(()=>{let t=class t{constructor(s,r,n,l,h){this._fb=s,this._router=r,this._titleService=n,this._title=l,this._agInService=h,this.alertType="error",this.alertMessage="",this.containerForm=this._fb.group({container:["",[z.required,z.pattern(ve)]]}),this._title.update("Verify Tote"),this._titleService.setTitle("agIn/verify-tote")}ngOnInit(){if(this.endContainer=this._agInService.endContainer,this.outsetContainer=this._agInService.outsetContainer,!this.endContainer||!this.outsetContainer){this._router.navigate(["agin"]);return}}ngAfterViewInit(){this.containerInput.nativeElement.select()}onSubmit(){if(this.alertMessage="",this.containerForm.invalid){this.containerInput.nativeElement.select();return}if(this.endContainer.type==="shelf"&&this.containerForm.get("container").value!==this.outsetContainer.Barcode){this.alertMessage="Please sacn the start tote.",this.containerInput.nativeElement.select();return}if(this.endContainer.type==="tote"&&this.containerForm.get("container").value!==this.endContainer.Barcode){this.alertMessage="Please sacn the end tote.",this.containerInput.nativeElement.select();return}this._router.navigate(["agin/verifyitn"])}};t.\u0275fac=function(r){return new(r||t)(f(ge),f(A),f(pe),f(he),f(L))},t.\u0275cmp=M({type:t,selectors:[["verify-tote"]],viewQuery:function(r,n){if(r&1&&x(ai,5),r&2){let l;P(l=F())&&(n.containerInput=l.first)}},standalone:!0,features:[le],decls:16,vars:3,consts:[[1,"container","mx-auto","px-2","py-2","md:mt-4"],["nz-form","","focusInvalidInput","",3,"formGroup","ngSubmit"],["nz-row","","nzJustify","center"],["nz-col","","nzXs","20","nzSm","16","nzMd","12","nzLg","10","nzXl","8","nzXXl","6"],["class","grid grid-rows-3",4,"ngIf"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","The input is not valid container!"],["nz-input","","placeholder"," ","formControlName","container","placeholder","Barcode","nzSize","large","type","text","id","container","name","container","autocomplete","off"],["container",""],["nz-col","","nzSpan","13"],["nz-button","","type","submit","nzType","primary","nzSize","large",1,"w-full",3,"click"],["nz-row","","nzJustify","center",4,"ngIf"],[1,"grid","grid-rows-3"],["class","text-xl font-bold",4,"ngIf"],[1,"text-lg"],["class","text-lg",4,"ngIf"],[1,"text-xl","font-bold"],["nzShowIcon","",1,"w-full",3,"nzType","nzMessage"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"form",1),y("ngSubmit",function(){return n.onSubmit()}),o(2,"div",2)(3,"div",3),v(4,ci,7,5,"div",4),o(5,"nz-form-item",2)(6,"nz-form-label",5),p(7,"Tote"),a(),o(8,"nz-form-control",6),C(9,"input",7,8),a()(),o(11,"nz-form-item",2)(12,"div",9)(13,"button",10),y("click",function(){return n.onSubmit()}),p(14," Submit "),a()()(),v(15,pi,2,2,"nz-form-item",11),a()()()()),r&2&&(m(1),c("formGroup",n.containerForm),m(3),c("ngIf",n.endContainer),m(11),c("ngIf",n.alertMessage))},dependencies:[X,q,$,G,W,ie,j,V,ee,Z,_e,te,oe,H,U,J,Ie,w,Y,K,Q,B,R,k,fe,re,ne],encapsulation:2});let e=t;return e})();var di=[{path:"",component:xe},{path:"location",component:Fe},{path:"verifytote",component:Ae},{path:"verifyitn",component:we}],Ft=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ee({type:t}),t.\u0275inj=Le({imports:[$e.forChild(di),$e]});let e=t;return e})();var Hn=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ee({type:t,bootstrap:[xe]}),t.\u0275inj=Le({providers:[L],imports:[ut,Ft,X,H,Y,ct,Q,ie,re,Lt,Me,zt,Fe,Ae,we]});let e=t;return e})();export{Hn as AggregationInModule};
