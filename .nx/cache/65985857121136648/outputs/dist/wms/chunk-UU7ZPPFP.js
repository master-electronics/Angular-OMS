import{a as st}from"./chunk-Z6BDTNTK.js";import"./chunk-5VGBK5M2.js";import{k as at}from"./chunk-EDQ2XWAO.js";import{a as rt}from"./chunk-QTNYEYCW.js";import{a as nt}from"./chunk-GKR6SDXW.js";import{a as ot}from"./chunk-XHQXBUEX.js";import"./chunk-RMIKNTFD.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import{j as it}from"./chunk-Y7DOXW3K.js";import"./chunk-J3DDCTFF.js";import{a as y}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as P}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{e as et}from"./chunk-TREYRKOP.js";import{E as Y,H as Z,I as tt,e as K,i as W,t as X}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-WX6KJXZ2.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{a as q,b as Q,c as H}from"./chunk-V5UEWFGK.js";import{a as S}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as G,k as J}from"./chunk-PJEV5NXI.js";import{A as j,p as R,q as z,w as $}from"./chunk-GWV5DZOT.js";import{$b as h,Ba as D,C as d,Da as w,Fb as m,Gb as p,Gc as V,H as _,Hc as k,Ia as x,Ja as E,Lc as C,Mc as T,Q as v,Sb as u,V as L,ac as l,bc as f,dc as F,ec as A,fc as M,gc as O,na as N,nc as b,pc as g,qa as B,xc as I,yc as U}from"./chunk-N7LPRJLK.js";function ut(o,n){o&1&&M(0)}function dt(o,n){if(o&1&&(l(0,"span"),I(1),f()),o&2){let s=g().$implicit;m(1),U(s.Barcode)}}function pt(o,n){if(o&1&&(l(0,"div"),h(1,dt,2,1,"span",0),f()),o&2){let s=n.$implicit;m(1),u("ngIf",s.Status!="done")}}var lt=()=>({xs:8,sm:16,md:24,lg:32});function ft(o,n){if(o&1&&(l(0,"div")(1,"div",2)(2,"div",3)(3,"span",4),I(4,"Locations:"),f(),l(5,"div",5),h(6,pt,2,1,"div",6),f()()()()),o&2){let s=g();m(1),u("nzGutter",k(2,lt)),m(5),u("ngForOf",s.locations)}}function ht(o,n){if(o&1){let s=O();F(0),l(1,"popup-modal",7),b("clickSubmit",function(){x(s);let t=g();return E(t.resetTimeout())}),f(),A()}if(o&2){let s=g();m(1),u("message",s.timeoutAlert)}}var zt=(()=>{let n=class n{constructor(e,t,i,c,r,a){this._fb=e,this._actRoute=t,this._findContainer=i,this._router=c,this._eventLog=r,this._auditService=a,this.userInfo=D(P),this.inputForm=this._fb.nonNullable.group({barcode:["",[K.required]]}),this.timeoutSeconds=0}ngOnInit(){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._actRoute.data.pipe(_(t=>{let i=JSON.parse(sessionStorage.getItem("searchLocations"));if(this.locations=[],i){i.forEach(a=>{this.locations.push({Barcode:a.Barcode,Status:a.Status=="done"?a.Status:"open"})}),sessionStorage.setItem("searchLocations",JSON.stringify(this.locations)),this.lastUpdated=Number(e?.LastUpdated),this.auditTimeout=t?.Location?.auditTimeout?.data?.fetchConfigValue.Value,this.alertTime=t?.Location?.alertTime?.data?.fetchConfigValue.Value,this.auditInfo={Container:{Barcode:t.Location.location[0].Barcode}};let r=v(1e3);return this.subscription=r.subscribe(a=>this.timer()),d(!0)}t.Location.location.forEach(r=>{this.locations.push({Barcode:r.Barcode,Status:"open"})}),this.lastUpdated=Number(e?.LastUpdated),this.auditTimeout=t?.Location?.auditTimeout?.data?.fetchConfigValue.Value,this.alertTime=t?.Location?.alertTime?.data?.fetchConfigValue.Value,this.auditInfo={Container:{Barcode:t.Location.location[0].Barcode}};let c=v(1e3);return this.subscription=c.subscribe(r=>this.timer()),sessionStorage.setItem("searchLocations",JSON.stringify(this.locations)),d(!0)})),this.data$=d(!0)}timer(){++this.timeoutSeconds;let e=(this.lastUpdated+this.auditTimeout*1e3-(this.timeoutSeconds*1e3+this.lastUpdated))/1e3;if(e==0){this._router.navigate(["../../../menu"],{relativeTo:this._actRoute});return}e==this.alertTime&&(new st().beep(100,520),this.showTimeoutAlert=!0);let t=Math.floor(e/600),i=e%60,c=t<10?"0"+t.toString():t.toString(),r=i<10?"0"+i.toString():i.toString();this.timeoutAlert="Audit will timeout in "+c+":"+r}resetTimeout(){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.updateLastUpdated(e.InventoryID,10,new Date(Date.now()).toISOString()).pipe(_(()=>{e.LastUpdated=new Date(Date.now()).getTime().toString(),sessionStorage.setItem("currentAudit",JSON.stringify(e))}),L(t=>d({error:t}))),this.timeoutSeconds=0,this.showTimeoutAlert=!1}onSubmit(){let e=this.inputForm.value.barcode.replace(/-/g,"").trim();if(!this.locations.find(i=>i.Barcode==e&&i.Status!="done"))this.data$=d({error:{message:"Incorrect Location!",type:"error"}});else{let i=[{UserEventID:y.Event_IM_Search_Location_Scanned,UserName:this.userInfo.userName,DistributionCenter:S.DistributionCenter,Message:"Location: "+e}],c=[{UserName:this.userInfo.userName,EventTypeID:y.Event_IM_Search_Location_Scanned,Log:JSON.stringify({DistributionCenter:S.DistributionCenter,Location:e})}];this.data$=this._eventLog.insertLog(i,c).pipe(N(r=>this._findContainer.fetch({Container:{DistributionCenter:S.DistributionCenter,Barcode:e}},{fetchPolicy:"network-only"}).pipe(B(a=>{if(!a.data.findContainer)throw new Error("Location not found")}),_(a=>{let ct=this.locations.find(mt=>mt.Barcode==e);ct.Status="active",sessionStorage.setItem("searchLocations",JSON.stringify(this.locations)),this._router.navigate(["../scan-itn"],{relativeTo:this._actRoute})}))),L(r=>d({error:{message:r.message,type:"error"}})))}}onBack(){this._router.navigate(["../../scan-itn"],{relativeTo:this._actRoute})}ngOnDestroy(){this.subscription?.unsubscribe()}};n.\u0275fac=function(t){return new(t||n)(p(Y),p(G),p(it),p(J),p(rt),p(at))},n.\u0275cmp=w({type:n,selectors:[["ng-component"]],standalone:!0,features:[V],decls:6,vars:10,consts:[[4,"ngIf"],["inputType","string","controlName","barcode","title","Scan Location:",3,"data","formGroup","isvalid","formSubmit","formBack"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","14",1,"text-black","md:text-lg","lg:text-xl"],[1,"mr-2","font-medium",2,"vertical-align","top"],[1,"justify-self-start","text-blue-600",2,"display","inline-block"],[4,"ngFor","ngForOf"],[3,"message","clickSubmit"]],template:function(t,i){t&1&&(h(0,ut,1,0,"ng-container",0),C(1,"async"),h(2,ft,7,3,"div",0),l(3,"single-input-form",1),b("formSubmit",function(){return i.onSubmit()})("formBack",function(){return i.onBack()}),C(4,"async"),f(),h(5,ht,2,1,"ng-container",0)),t&2&&(u("ngIf",T(1,6,i.info$)),m(2),u("ngIf",i.locations.length>0),m(1),u("data",T(4,8,i.data$))("formGroup",i.inputForm)("isvalid",i.inputForm.valid),m(2),u("ngIf",i.showTimeoutAlert))},dependencies:[j,R,z,$,ot,tt,W,X,nt,et,H,Q,q,Z],encapsulation:2});let o=n;return o})();export{zt as ScanLocation};
