import{a as it}from"./chunk-BIBHMHBF.js";import{a as at}from"./chunk-Z6BDTNTK.js";import{a as ut}from"./chunk-5VGBK5M2.js";import{k as ot}from"./chunk-EDQ2XWAO.js";import{a as rt}from"./chunk-QTNYEYCW.js";import{a as nt}from"./chunk-GKR6SDXW.js";import{a as et}from"./chunk-XHQXBUEX.js";import"./chunk-RMIKNTFD.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import"./chunk-J3DDCTFF.js";import{a as I}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as z}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{e as tt}from"./chunk-TREYRKOP.js";import{b as Z}from"./chunk-MZCJXFXF.js";import{E as W,H as X,I as Y,e as G,i as q,t as K}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-WX6KJXZ2.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{a as H,b as J,c as j}from"./chunk-V5UEWFGK.js";import{a as p}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as x,k as $}from"./chunk-PJEV5NXI.js";import{A as Q,q as V,w as R}from"./chunk-GWV5DZOT.js";import{$b as C,Ba as B,C as o,Da as w,Fb as s,Gb as m,Gc as U,H as d,Ia as O,Ja as k,Lc as h,Mc as N,Q as M,Sb as u,V as A,ac as f,bc as T,cc as v,dc as b,ec as D,gc as L,na as g,nc as _,pc as y,qa as F,xc as E}from"./chunk-N7LPRJLK.js";function mt(r,i){if(r&1&&(b(0),v(1,"audit-info",6),D()),r&2){let c=y();s(1),u("auditInfo",c.audit)}}function pt(r,i){if(r&1){let c=L();b(0),f(1,"popup-modal",7),_("clickSubmit",function(){O(c);let t=y();return k(t.onBack())}),T(),D()}if(r&2){let c=y();s(1),u("message",c.message)}}function It(r,i){if(r&1){let c=L();b(0),f(1,"popup-modal",7),_("clickSubmit",function(){O(c);let t=y();return k(t.resetTimeout())}),T(),D()}if(r&2){let c=y();s(1),u("message",c.timeoutAlert)}}function vt(r,i){r&1&&v(0,"div")}function yt(r,i){r&1&&v(0,"div")}var xt=(()=>{let i=class i{constructor(e,t,n,a,l,S){this._fb=e,this._actRoute=t,this._router=n,this._auditService=a,this._eventLog=l,this._configService=S,this.userInfo=B(z),this.inputForm=this._fb.nonNullable.group({ITN:["",[G.required]]}),this.timeoutSeconds=0}ngOnInit(){sessionStorage.removeItem("currentAudit"),sessionStorage.removeItem("auditITN"),sessionStorage.removeItem("searchLocations"),this.audit=null,this.info$=this._actRoute.data.pipe(d(e=>{if(e?.Audit?.audit?.InventoryID){this.auditTimeout=e?.Audit?.auditTimeout?.data?.fetchConfigValue?.Value,this.alertTime=e?.Audit?.alertTime?.data?.fetchConfigValue?.Value,this.audit=e.Audit.audit,this.lastUpdated=Number(e.Audit.audit.LastUpdated),sessionStorage.setItem("currentAudit",JSON.stringify(this.audit));let t=M(1e3);return this.subscription=t.subscribe(n=>this.timer()),o(!0)}else return this.message="There are no more Audits",o(!1)})),this.data$=o(!0)}getConfig(){this.config$=this._configService.getValue("IM_Audit_Timeout").pipe(d(e=>e.data.fetchConfigValue.Value))}resetTimeout(){let e=JSON.parse(sessionStorage.getItem("currentAudit"));this.data$=this._auditService.updateLastUpdated(e.InventoryID,10,new Date(Date.now()).toISOString()).pipe(d(()=>(e.LastUpdated=new Date(Date.now()).getTime().toString(),sessionStorage.setItem("currentAudit",JSON.stringify(e)),o(!0))),A(t=>o({error:t}))),this.timeoutSeconds=0,this.showTimeoutAlert=!1}timer(){++this.timeoutSeconds;let e=(this.lastUpdated+this.auditTimeout*1e3-(this.timeoutSeconds*1e3+this.lastUpdated))/1e3;if(e==0){this.onBack();return}e==this.alertTime&&(new at().beep(100,520),this.showTimeoutAlert=!0);let t=Math.floor(e/60),n=e%60,a=t<10?"0"+t.toString():t.toString(),l=n<10?"0"+n.toString():n.toString();this.timeoutAlert="Audit will timeout in "+a+":"+l}onSubmit(){let e=this.inputForm.value.ITN.trim(),t=JSON.parse(sessionStorage.getItem("currentAudit"));this.info$=this._auditService.validateAssignment$(t._id,this.userInfo.userId).pipe(d(n=>{if(n.data.validateAssignment){if(Z.test(e))if(this.audit.Inventory.ITN!=e)this.data$=o({error:{message:"Incorrect ITN!",type:"error"}});else{sessionStorage.setItem("auditITN",this.audit.Inventory.ITN);let a=[{UserEventID:I.Event_IM_ITN_Scanned,UserName:this.userInfo.userName,DistributionCenter:p.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),Message:"ITN: "+this.inputForm.value.ITN}],l=[{UserName:this.userInfo.userName,EventTypeID:I.Event_IM_ITN_Scanned,Log:JSON.stringify({DistributionCenter:p.DistributionCenter,InventoryTrackingNumber:this.inputForm.value.ITN,ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}];this.data$=this._eventLog.insertLog(a,l).pipe(g(()=>this._auditService.updateLastUpdated(t.InventoryID,10,new Date(Date.now()).toISOString())),g(S=>this._auditService.nextSubAudit$(this.audit.InventoryID,this.userInfo.userId).pipe(F(P=>{if(P)return this._router.navigate(["../"+P.Route],{relativeTo:this._actRoute}),S;{let st=[{UserEventID:I.Event_IM_Audit_Completed,UserName:this.userInfo.userName,DistributionCenter:p.DistributionCenter,InventoryTrackingNumber:this.audit.Inventory.ITN}],ct=[{UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Audit_Completed,Log:JSON.stringify({DistributionCenter:p.DistributionCenter,InventoryTrackingNumber:sessionStorage.getItem("auditITN"),ParentITN:t.Inventory.ParentITN,BinLocation:t.Container.Barcode,QuantityOnHand:t.Inventory.Quantity,OriginalQuantity:t.Inventory.OriginalQuantity,DateCode:t.Inventory.DateCode,CountryOfOrigin:t.Inventory.COO,ROHS:t.Inventory.ROHS,NotFound:t.Inventory.NotFound,Suspect:t.Inventory.Suspect,LocatedInAutostore:t.Inventory.LocatedInAutostore,BoundForAutostore:t.Inventory.BoundForAutostore,PartNumber:t.Inventory.Product.PartNumber,ProductCode:t.Inventory.Product.ProductCode.ProductCodeNumber,Description:t.Inventory.Product.Description,ProductTier:t.Inventory.Product.ProductTier,ProductType:t.Inventory.Product.ProductType.ProductType,ProductTypeDescription:t.Inventory.Product.ProductType.Description,Velocity:t.Inventory.Product.Velocity,MICPartNumber:t.Inventory.Product.MICPartNumber,UOM:t.Inventory.Product.UOM,Autostore:t.Inventory.Product.Autostore,PackType:t.Inventory.Product.PackType,PackQuantity:t.Inventory.Product.PackQty,Cost:t.Inventory.Product.Cost})}];return this.close$=this._eventLog.insertLog(st,ct).pipe(g(lt=>this._auditService.closeAudit(this.audit.InventoryID,10,this.audit.Inventory.ITN,this.userInfo.userName).pipe(d(dt=>(this._router.navigate(["../verify/scan-location"],{relativeTo:this._actRoute}),dt))))),o(!0)}}),A(P=>o({error:{message:P.message,type:"error"}})))))}else this.data$=o({error:{message:"Invalid ITN format",type:"error"}});return o(!0)}else return this.message="This Audit has timed out!",sessionStorage.removeItem("currentAudit"),sessionStorage.removeItem("auditITN"),o(!0)}))}onBack(){this._router.navigate(["../../menu"],{relativeTo:this._actRoute})}onNotFound(){let e=JSON.parse(sessionStorage.getItem("currentAudit"));sessionStorage.setItem("searchLevel","1");let t=[{UserEventID:I.Event_IM_Audit_ITN_NF,UserName:this.userInfo.userName,DistributionCenter:p.DistributionCenter,InventoryTrackingNumber:e.Inventory.ITN}],n=[{UserName:this.userInfo.userName,EventTypeID:I.Event_IM_Audit_ITN_NF,Log:JSON.stringify({DistributionCenter:p.DistributionCenter,InventoryTrackingNumber:e.Inventory.ITN,ParentITN:e.Inventory.ParentITN,BinLocation:e.Container.Barcode,QuantityOnHand:e.Inventory.Quantity,OriginalQuantity:e.Inventory.OriginalQuantity,DateCode:e.Inventory.DateCode,CountryOfOrigin:e.Inventory.COO,ROHS:e.Inventory.ROHS,NotFound:e.Inventory.NotFound,Suspect:e.Inventory.Suspect,LocatedInAutostore:e.Inventory.LocatedInAutostore,BoundForAutostore:e.Inventory.BoundForAutostore,PartNumber:e.Inventory.Product.PartNumber,ProductCode:e.Inventory.Product.ProductCode.ProductCodeNumber,Description:e.Inventory.Product.Description,ProductTier:e.Inventory.Product.ProductTier,ProductType:e.Inventory.Product.ProductType.ProductType,ProductTypeDescription:e.Inventory.Product.ProductType.Description,Velocity:e.Inventory.Product.Velocity,MICPartNumber:e.Inventory.Product.MICPartNumber,UOM:e.Inventory.Product.UOM,Autostore:e.Inventory.Product.Autostore,PackType:e.Inventory.Product.PackType,PackQuantity:e.Inventory.Product.PackQty,Cost:e.Inventory.Product.Cost})}];this.data$=this._eventLog.insertLog(t,n).pipe(g(()=>this._auditService.updateLastUpdated(e.InventoryID,10,new Date(Date.now()).toISOString())),d(a=>(this._router.navigate(["../search/scan-location"],{relativeTo:this._actRoute}),a)))}ngOnDestroy(){this.subscription?.unsubscribe()}};i.\u0275fac=function(t){return new(t||i)(m(W),m(x),m($),m(ot),m(rt),m(it))},i.\u0275cmp=w({type:i,selectors:[["ng-component"]],standalone:!0,features:[U],decls:16,vars:17,consts:[["inputType","string","controlName","ITN","title","Scan ITN:",3,"data","formGroup","isvalid","formSubmit","formBack"],[2,"height","20px"],[4,"ngIf"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","10","nzOffset","7",1,"grid","h-12"],["type","button",1,"h-full","w-full","rounded-lg","bg-red-700","font-medium","text-white","hover:bg-red-500","focus:outline-none","focus:ring-4","focus:ring-red-300","disabled:bg-red-200","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-900",3,"click"],[3,"auditInfo"],[3,"message","clickSubmit"]],template:function(t,n){t&1&&(f(0,"single-input-form",0),_("formSubmit",function(){return n.onSubmit()})("formBack",function(){return n.onBack()}),h(1,"async"),T(),v(2,"div",1),C(3,mt,2,1,"ng-container",2),h(4,"async"),v(5,"div",1),f(6,"div",3)(7,"div",4)(8,"button",5),_("click",function(){return n.onNotFound()}),E(9," Not Found "),T()()(),C(10,pt,2,1,"ng-container",2)(11,It,2,1,"ng-container",2)(12,vt,1,0,"div",2),h(13,"async"),C(14,yt,1,0,"div",2),h(15,"async")),t&2&&(u("data",N(1,9,n.data$))("formGroup",n.inputForm)("isvalid",n.inputForm.valid),s(3),u("ngIf",N(4,11,n.info$)),s(3),u("nzGutter",8),s(4),u("ngIf",n.message),s(1),u("ngIf",n.showTimeoutAlert),s(1),u("ngIf",N(13,13,n.close$)),s(2),u("ngIf",N(15,15,n.config$)))},dependencies:[Q,V,R,et,Y,q,K,nt,tt,j,J,H,X,ut],encapsulation:2});let r=i;return r})();export{xt as ScanITN};
