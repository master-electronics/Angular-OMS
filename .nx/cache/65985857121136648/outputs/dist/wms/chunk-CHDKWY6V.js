import{a as K}from"./chunk-CNRANGED.js";import{b as v,c as E,d as R,f as U,g as k,j as Q,k as $,l as G,m as x,n as F,o as H,p as V,q as B,r as J,s as _,t as q,u as z,v as W,w as Z}from"./chunk-MFWTQF6C.js";import{a as j}from"./chunk-I3G2JKLN.js";import{a as l}from"./chunk-PLQ7TNCQ.js";import{f as O,i as b,j as C}from"./chunk-C55YZZU5.js";import{I as L,J as M}from"./chunk-GWV5DZOT.js";import{Aa as r,C as c,G as D,H as m,I as f,V as g,n as T,na as p,qa as N,va as I}from"./chunk-N7LPRJLK.js";var St=C`
    query fetchAutostoreMessages($maxRetries: Int) {
  fetchAutostoreMessages(MaxRetries: $maxRetries) {
    _id
    Type
    TypeID
    Action
    Endpoint
    Status
    Timestamp
    Message
    ErrorCount
  }
}
    `;var ht=C`
    mutation insertAutostoreMessage($message: autostoreMessage) {
  insertAutostoreMessage(AutostoreMessage: $message) {
    _id
  }
}
    `,P=(()=>{let a=class a extends b{constructor(e){super(e),this.document=ht,this.client="wmsNodejs"}};a.\u0275fac=function(t){return new(t||a)(r(O))},a.\u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"});let h=a;return h})();var tt=(()=>{let a=class a{constructor(e,t,n,s,u){this._findProduct=e,this._insertMessage=t,this._updateMessage=n,this._updateLastSync=s,this.http=u,this.httpOptions={headers:new L({"Content-Type":"application/json"})}}sendToAutostore$(e){return f(e.map(t=>{let n={};return console.log("ID-"+t),this._findProduct.fetch({product:{_id:t}},{fetchPolicy:"network-only"}).pipe(m(s=>{let u=s.data.findProduct._id,i=s.data.findProduct.PartNumber,o=s.data.findProduct.ProductCode.ProductCodeNumber,S=s.data.findProduct.Description?s.data.findProduct.Description.trim():null,y=s.data.findProduct.Velocity=="A"?"A":s.data.findProduct.Velocity=="B"||s.data.findProduct.Velocity=="C"?"B":"C",w=s.data.findProduct.UOM?s.data.findProduct.UOM.trim():"EACH",A=s.data.findProduct.MICPartNumber?s.data.findProduct.MICPartNumber.trim():null;n.Type="PRODUCT",n.TypeID=u,n.AutostoreID=o+"-"+i,n.Action="insert",n.Endpoint="/products",n.Method="POST",n.Status="unsent",n.Timestamp=new Date(Date.now()).toISOString();let d="{";return d+=`"productId": "${o+"-"+i}", "owner": "MasterElectronics",`,S&&(d+=`"description": "${S}",`),y&&(d+=`"velocity": "${y}",`),d+=`"productUom": [ {"uomId": "${w}",`,A&&(d+=`"imagePath": "${l.productImgSource+A+".jpg"}",`),d+='"ratio": 1, "baseUomFlag": true, "pickUomFlag": false, "putawayUomFlag": false} ] }',n.Message=d,console.log(n),s}),p(s=>f({productDataMessage:this._insertMessage.mutate({message:n}),productLastSync:this.updateLastSync(t)})),p(s=>{let u=JSON.parse(JSON.stringify(n));u._id=s.productDataMessage.data.insertAutostoreMessage._id;let i={pattern:"PRODUCT_message",data:{message:u}};return f({productMessage:this.sendMessage(i),productMessageStatus:this.updateMessageStatus("sent",s.productDataMessage.data.insertAutostoreMessage._id)})}))}))}sendMessage(e){try{let t=this.http.post(`${l.apiUrl}/Autostore/message`,e,this.httpOptions);return console.log(t),t}catch(t){return c(t)}}updateMessageStatus(e,t){return this._updateMessage.mutate({autostoreMessage:{Status:e},id:t}).pipe(n=>n)}updateLastSync(e){return this._updateLastSync.mutate({product:{_id:e,LastAutostoreSync:new Date(Date.now()).toISOString()}}).pipe(t=>t)}insertProduct$(){}};a.\u0275fac=function(t){return new(t||a)(r(k),r(P),r(_),r(q),r(M))},a.\u0275prov=I({token:a,factory:a.\u0275fac});let h=a;return h})();var wt=(()=>{let a=class a{constructor(e,t,n,s,u,i,o,S,y,w,A,d,et,nt,st,it,rt,ot,at,ut,ct){this._userC=e,this._verifyITN=t,this._move=n,this._asnInventory=s,this._insertASN=u,this._verifyLocation=i,this._verifyLocationStatus=o,this._insertMessage=S,this.http=y,this._productService=w,this._updateASN=A,this._updateMessage=d,this._findReplenishmentItem=et,this._updateReplenishmentitem=nt,this._findASN=st,this._updateParentContainer=it,this._itnLocationChange=rt,this._itnChange=ot,this._clearSuspect=at,this._updateProduct=ut,this._globalASNReject=ct,this.httpOptions={headers:new L({"Content-Type":"application/json"})},this._replenishmentItem=new T(null)}moveItnToUser(e){return this._verifyITN.fetch({ITN:e,DC:l.DistributionCenter},{fetchPolicy:"network-only"}).pipe(N(t=>{if(!t.data.findInventory)throw new Error("ITN not found");if(!this._userC.userContainerID)throw new Error("Container not found")}),p(t=>this._move.mutate({ITN:e,DC:l.DistributionCenter,ContainerID:this._userC.userContainerID})))}moveItnToLocation(e,t,n,s){return console.log("BL-"+s),f({move:this._move.mutate({ITN:e,DC:l.DistributionCenter,ContainerID:t,boundForAutostore:!0,suspect:!0,suspectReason:j.ASN_Inventory_Suspect_Reason}).pipe(g(u=>{throw new Error(u)})),itnChange:this.itnChange(n,e,s,"true")})}findContainer(e){return this._verifyLocation.fetch({container:{Barcode:e}},{fetchPolicy:"network-only"}).pipe(m(t=>t))}sendToAutostore$(e){let t,n,s;return this._verifyLocation.fetch({container:{Barcode:e}},{fetchPolicy:"network-only"}).pipe(N(u=>{if(!u.data.findContainer)throw new Error("Can't find this location");t=u.data.findContainer._id}),p(u=>this._verifyLocationStatus.fetch({asn:{ContainerID:t,Status:"Open"}},{fetchPolicy:"network-only"}).pipe(N(i=>{if(i.data.verifyASNLocationStatus.length>0)throw new Error(`Open ASN '${i.data.verifyASNLocationStatus[0].tuId}' already exists`)}),p(i=>this.fetchASNInventory$(t)),p(i=>(n=i,this.asn.AUTOSTOREASNLINEs.length!=0?this.insertASN$():c(null))),p(i=>{if(this.asn.AUTOSTOREASNLINEs.length!=0){this.asnID=i;let o=D(this._productService.sendToAutostore$(this.productList)).then(S=>{});return c(i)}else return c(null)}),p(i=>{let o;return this.asn.AUTOSTOREASNLINEs.length!=0?this.insertMessage$():c(null)}),p(i=>{if(this.asn.AUTOSTOREASNLINEs.length!=0){s=i.data.insertAutostoreMessage._id;let o=JSON.parse(JSON.stringify(this.message));o._id=i.data.insertAutostoreMessage._id;let S={pattern:"ASN_message",data:{message:o}};return this.sendMessage(S)}else return c(null)}),p(i=>this.asn.AUTOSTOREASNLINEs.length!=0?this.updateMessageStatus("sent",s):c(null)),p(i=>this.asn.AUTOSTOREASNLINEs.length!=0?this.updateASNStatus("Sent",this.asnID):c(null)),p(i=>this.asn.AUTOSTOREASNLINEs.length!=0?f({ASNID:c(this.asnID),ZeroList:n.length>0?c(n):c(null)}):f({ASNID:c("0"),ZeroList:n.length>0?c(n):c(null)})))))}insertMessage$(){this.message={},this.message.Type="ASN",this.message.TypeID=this.asnID,this.message.AutostoreID=this.asnID.toString(),this.message.Action="insert",this.message.Endpoint="/asns",this.message.Method="POST",this.message.Status="unsent",this.message.Timestamp=new Date(Date.now()).toISOString();let e={},t=[];e.owner="MasterElectronics";let n={tuId:this.asnID.toString(),tuType:this.asn.tuType};e.transportUnit=n;let s=1;return this.asn.AUTOSTOREASNLINEs.map(u=>{let i={},o=[];i.lineNumber=s,i.productId=u.productId,i.quantityExpected=u.quantityExpected,o.push({name:"itn",value:u.InventoryTrackingNumber}),i.attributeValue=o,t.push(i),s++}),e.asnLine=t,this.message.Message=JSON.stringify(e),this._insertMessage.mutate({message:this.message})}insertASN$(){let e=JSON.parse(JSON.stringify(this.asn));return e.AUTOSTOREASNLINEs.map(t=>{delete t.InventoryTrackingNumber}),this._insertASN.mutate({asn:e}).pipe(m(t=>(this.asnID=t.data.insertAutostoreASN._id,this.asnID)))}fetchASNInventory$(e){return this.inventoryList=[],this.productList=[],this.asn={},this._asnInventory.fetch({container:{_id:e}},{fetchPolicy:"network-only"}).pipe(m(t=>{t.data.findContainer.INVENTORies.map(o=>{this.inventoryList.push(o)});let n=1,s=[],u=[],i=1;return this.inventoryList.map(o=>{!o.QuantityOnHand||o.QuantityOnHand==0?u.push(o.InventoryTrackingNumber):(this.productList.push(o.Product._id),s.push({lineNumber:n,productId:o.Product.ProductCode.ProductCodeNumber.toString()+"-"+o.Product.PartNumber.toString(),packagingUom:o.packagingUom,quantityExpected:Number(o.QuantityOnHand),InventoryID:Number(o._id),InventoryTrackingNumber:o.InventoryTrackingNumber}),n++,i++)}),this.asn.tuType="BIN-1x1",this.asn.Status="Open",this.asn.ContainerID=e,this.asn.AUTOSTOREASNLINEs=s,u}))}sendMessage(e){let t=l.apiUrl,n="woot";try{return this.http.post(`${l.apiUrl}/Autostore/message`,e,this.httpOptions)}catch(s){return c(s)}}updateASNStatus(e,t){return this._updateASN.mutate({asn:{Status:e},asnid:t}).pipe(n=>n)}updateMessageStatus(e,t){return this._updateMessage.mutate({autostoreMessage:{Status:e},id:t}).pipe(n=>n)}get nextReplenishmentItem$(){return this._findReplenishmentItem.fetch({barcode:sessionStorage.getItem("asnLocation")},{fetchPolicy:"network-only"}).pipe(m(e=>{let t=e.data.findASNReplenishmentInventory[0];return{_id:t._id,InventoryID:t.InventoryID,ProductID:t.ProductID,Status:t.Status,Barcode:t.Barcode,Warehouse:t.Warehouse,Row:t.Row,Aisle:t.Aisle,Section:t.Section,Shelf:t.Shelf,ShelfDetail:t.ShelfDetail,InventoryTrackingNumber:t.InventoryTrackingNumber}}))}fetchASN(e){return this._findASN.fetch({itn:e},{fetchPolicy:"network-only"}).pipe(m(t=>t),g(t=>{throw new Error(t)}))}updateASNReplenishmentItem(e,t){let n={_id:e,Status:t};return this._updateReplenishmentitem.mutate({replenishmentItem:n}).pipe(g(s=>{throw new Error(s)}))}globalASNRejection(e){return this._globalASNReject.mutate({inventoryID:e}).pipe(m(t=>t),g(t=>{throw new Error(t)}))}updateASNParentContainer(e,t){let n={ParentContainerID:t};return this._updateParentContainer.mutate({container:n,id:e}).pipe(g(s=>{throw new Error(s)}))}itnLocationChange(e,t,n){return this._itnLocationChange.mutate({user:e,itn:t,binLocation:n},{fetchPolicy:"network-only"})}itnChange(e,t,n,s){return this._itnChange.mutate({user:e,itn:t,binLocation:n,boundForAutostore:s},{fetchPolicy:"network-only"})}clearSuspect(e,t,n,s){return this._clearSuspect.mutate({user:e,itn:t,binLocation:n,suspect:s},{fetchPolicy:"network-only"}).pipe(g(u=>{throw new Error(u)}))}updateProduct(e){return this._updateProduct.mutate({product:e},{fetchPolicy:"network-only"}).pipe(g(t=>{throw new Error(t)}))}};a.\u0275fac=function(t){return new(t||a)(r(K),r(v),r(B),r(E),r(V),r(R),r(U),r(P),r(M),r(tt),r(J),r(_),r(F),r(z),r(H),r(W),r(Q),r($),r(G),r(x),r(Z))},a.\u0275prov=I({token:a,factory:a.\u0275fac});let h=a;return h})();export{tt as a,wt as b};
