import{a as he}from"./chunk-QTNYEYCW.js";import{b as _e}from"./chunk-CHDKWY6V.js";import"./chunk-CNRANGED.js";import{a as Ie}from"./chunk-GKR6SDXW.js";import"./chunk-E3B4WDOA.js";import"./chunk-OA6ZCSCG.js";import{a as fe}from"./chunk-XHQXBUEX.js";import"./chunk-RMIKNTFD.js";import"./chunk-D3FIXZL7.js";import"./chunk-ADHMVREX.js";import"./chunk-VJKYRYVM.js";import{i as ae,n as se}from"./chunk-MFWTQF6C.js";import{a as I}from"./chunk-I3G2JKLN.js";import"./chunk-LCEARWCQ.js";import{a as H}from"./chunk-4AGTE6D3.js";import"./chunk-5GWOD35Y.js";import"./chunk-POEXBOQJ.js";import{c as le,d as me,e as ce}from"./chunk-TREYRKOP.js";import{b as pe,c as de,d as ue}from"./chunk-JOHRHLSX.js";import{b as oe}from"./chunk-MZCJXFXF.js";import"./chunk-Z347V25R.js";import{E as ne,H as ie,I as re,e as X,h as Y,i as Z,o as ee,t as te}from"./chunk-L3THJMBJ.js";import"./chunk-RAQ4VAB7.js";import"./chunk-RMC6N2HF.js";import"./chunk-GJX7JKAF.js";import"./chunk-EXQESRXT.js";import"./chunk-5FUULRSO.js";import{c as K}from"./chunk-V5UEWFGK.js";import{a as f}from"./chunk-PLQ7TNCQ.js";import"./chunk-C55YZZU5.js";import"./chunk-GFVCXK67.js";import"./chunk-WOYNEQEU.js";import"./chunk-XSY6ZNJP.js";import"./chunk-W3KGMJG7.js";import"./chunk-B3MPBRHZ.js";import"./chunk-YUDS3XHK.js";import"./chunk-MIXZFVL7.js";import"./chunk-FFJ3QZ3H.js";import{i as q,k as Q}from"./chunk-PJEV5NXI.js";import{A as w,p as J,q as z,w as W}from"./chunk-GWV5DZOT.js";import{$b as _,C as h,Cc as U,Da as R,Fb as a,Gb as g,Gc as j,H as y,Hc as G,Ia as C,Ja as k,Lc as b,Mc as T,N as L,Sb as c,V as M,Vc as P,ac as i,bc as s,cc as p,dc as E,ec as D,f as O,gc as A,na as V,nc as S,pc as u,sc as B,wc as F,xc as m,yc as $,zc as v}from"./chunk-N7LPRJLK.js";function Te(t,r){if(t&1&&(i(0,"div",3),p(1,"span"),i(2,"span",4),m(3),s(),p(4,"span"),s()),t&2){let e=u(2);a(3),U(" ",e.itnInfo.Warehouse,"-",e.itnInfo.Row,"-",e.itnInfo.Aisle,"-",e.itnInfo.Section,"-",e.itnInfo.Shelf,"-",e.itnInfo.ShelfDetail," ")}}function ye(t,r){if(t&1&&(i(0,"div",5),p(1,"span"),i(2,"span",4),m(3,"Warehouse:"),s(),i(4,"span",6),m(5),s(),i(6,"span",4),m(7,"Row:"),s(),i(8,"span",6),m(9),s()()),t&2){let e=u(2);a(5),v(" ",e.itnInfo.Warehouse," "),a(4),v(" ",e.itnInfo.Row," ")}}function xe(t,r){if(t&1&&(i(0,"div",5),p(1,"span"),i(2,"span",4),m(3,"Aisle:"),s(),i(4,"span",6),m(5),s(),i(6,"span",4),m(7,"Section:"),s(),i(8,"span",6),m(9),s()()),t&2){let e=u(2);a(5),v(" ",e.itnInfo.Aisle," "),a(4),v(" ",e.itnInfo.Section," ")}}function Re(t,r){if(t&1&&(i(0,"div",5),p(1,"span"),i(2,"span",4),m(3,"Shelf:"),s(),i(4,"span",6),m(5),s(),i(6,"span",4),m(7,"Detail:"),s(),i(8,"span",6),m(9),s()()),t&2){let e=u(2);a(5),v(" ",e.itnInfo.Shelf," "),a(4),v(" ",e.itnInfo.ShelfDetail," ")}}function Ce(t,r){if(t&1&&(i(0,"div",5),p(1,"span"),i(2,"span",4),m(3,"ITN:"),s(),i(4,"span",7),m(5),s()()),t&2){let e=u(2);a(5),v(" ",e.itnInfo.InventoryTrackingNumber," ")}}function ke(t,r){if(t&1&&(i(0,"div"),_(1,Te,5,6,"div",1)(2,ye,10,2,"div",2)(3,xe,10,2,"div",2)(4,Re,10,2,"div",2)(5,Ce,6,1,"div",2),s()),t&2){let e=u();a(1),c("ngIf",e.itnInfo.Warehouse&&e.itnInfo.Row&&e.itnInfo.Aisle&&e.itnInfo.Section&&e.itnInfo.Shelf&&e.itnInfo.ShelfDetail),a(1),c("ngIf",e.itnInfo.Warehouse||e.itnInfo.Row),a(1),c("ngIf",e.itnInfo.Aisle||e.itnInfo.Section),a(1),c("ngIf",e.itnInfo.Shelf||e.itnInfo.ShelfDetail),a(1),c("ngIf",e.itnInfo.InventoryTrackingNumber)}}var ge=(()=>{let r=class r{};r.\u0275fac=function(l){return new(l||r)},r.\u0275cmp=R({type:r,selectors:[["itn-info"]],inputs:{itnInfo:"itnInfo"},standalone:!0,features:[j],decls:1,vars:1,consts:[[4,"ngIf"],["class","grid grid-cols-1 justify-items-center gap-0 text-black md:text-lg lg:text-xl",4,"ngIf"],["class","grid grid-cols-5 justify-items-end gap-0 text-black md:text-lg lg:text-xl",4,"ngIf"],[1,"grid","grid-cols-1","justify-items-center","gap-0","text-black","md:text-lg","lg:text-xl"],[1,"mr-2","font-medium"],[1,"grid","grid-cols-5","justify-items-end","gap-0","text-black","md:text-lg","lg:text-xl"],[1,"justify-self-start","text-blue-600"],[1,"col-span-3","justify-self-start","text-blue-600"]],template:function(l,o){l&1&&_(0,ke,6,5,"div",0),l&2&&c("ngIf",o.itnInfo)},dependencies:[w,z],encapsulation:2});let t=r;return t})();function Ee(t,r){if(t&1&&(E(0),p(1,"itn-info",9),D()),t&2){let e=u();a(1),c("itnInfo",e.replenishmentItem)}}function De(t,r){if(t&1){let e=A();E(0),i(1,"popup-modal",10),S("clickSubmit",function(){C(e);let l=u();return k(l.onBack())}),s(),D()}if(t&2){let e=u();a(1),c("message",e.error)}}function Ae(t,r){t&1&&p(0,"div")}function je(t,r){t&1&&p(0,"div")}function ze(t,r){t&1&&p(0,"div")}function we(t,r){t&1&&m(0,"Reject Reason")}function Oe(t,r){t&1&&(i(0,"span"),m(1," - Global"),s())}function Le(t,r){if(t&1){let e=A();i(0,"label",13),S("click",function(){let o=C(e).$implicit,d=u(2);return k(d.setGlobal(o.global))}),m(1),_(2,Oe,2,0,"span",2),s()}if(t&2){let e=r.$implicit;B("nzValue",e.label),a(1),$(e.label),a(1),c("ngIf",e.global)}}function Me(t,r){if(t&1){let e=A();E(0),i(1,"nz-radio-group",11),S("ngModelChange",function(l){C(e);let o=u();return k(o.rejectValue=l)}),_(2,Le,3,3,"label",12),s(),D()}if(t&2){let e=u();a(1),c("ngModel",e.rejectValue),a(1),c("ngForOf",e.rejectReasonList)}}var Ve=()=>({top:"5px"}),dt=(()=>{let r=class r{constructor(n,l,o,d,N,x,ve,Se){this._fb=n,this._asn=l,this._actRoute=o,this._router=d,this._eventLog=N,this._findReplenishmentItem=x,this._fetchRejectReasons=ve,this._userInfo=Se,this.inputForm=this._fb.nonNullable.group({ITN:["",[X.required]]})}ngOnInit(){this.rejectReasonList=[],this.rejectVisible=!1,this.replenishmentItem=null,this.info$=this._actRoute.data.pipe(y(n=>n.ReplenishmentItem.InventoryTrackingNumber?(this.replenishmentItem=n.ReplenishmentItem,sessionStorage.setItem("asnReplenishmentItem",JSON.stringify(this.replenishmentItem)),this.log$=this._eventLog.insertLog([{UserEventID:I.Event_Autostore_ASN_ITN_Presented,UserName:this._userInfo.userName,DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:this.replenishmentItem.InventoryTrackingNumber}],[{UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_ITN_Presented,Log:JSON.stringify({DistributionCenter:f.DistributionCenter,data:this.replenishmentItem})}]),h(!0)):(this.error="There are no more replenishment ITNs",h(!1)))),this.rejectReasons$=this._fetchRejectReasons.fetch({},{fetchPolicy:"network-only"}).pipe(y(n=>{n.data.fetchASNRejectionReasons.map(l=>{this.rejectReasonList.push({label:l.Reason,value:l._id.toString(),global:l.Global})})})),this.data$=h(!0),sessionStorage.removeItem("asnLocation"),sessionStorage.removeItem("asn-itn")}onSubmit(){let n=this.inputForm.value.ITN.trim();if(oe.test(n)){if(this.replenishmentItem.InventoryTrackingNumber!=n){this.data$=h({error:{message:"Incorrect ITN!",type:"error"}});return}sessionStorage.setItem("asnLocation",this.replenishmentItem.Barcode),sessionStorage.setItem("asn-itn",n),this.log$=this._eventLog.insertLog([{UserEventID:I.Event_Autostore_ASN_ITN_Scanned,UserName:this._userInfo.userName,DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:n}],[{UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_ITN_Scanned,Log:JSON.stringify({DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:n})}]),this._router.navigate(["../scan-location"],{relativeTo:this._actRoute});return}else this.data$=h({error:{message:"Invalid ITN format",type:"error"}})}onBack(){this._router.navigate(["../start-location"],{relativeTo:this._actRoute})}showRejectReasons(){this.rejectVisible=!0}hideRejectReasons(){this.rejectValue=null,this.rejectReasonIsGlobal=null,this.rejectVisible=!1}setGlobal(n){this.rejectReasonIsGlobal=n}onOk(){return O(this,null,function*(){let n=this.rejectValue,l=this.rejectReasonIsGlobal;if(this.rejectReasonIsGlobal){let o=[],d=[];o.push({UserEventID:I.Event_Autostore_ASN_ITN_Skipped,UserName:this._userInfo.userName,DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:JSON.parse(sessionStorage.getItem("asnReplenishmentItem")).InventoryTrackingNumber,Message:n}),d.push({UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_ITN_Skipped,Log:JSON.stringify({DistributionCenter:f.DistributionCenter,data:sessionStorage.getItem("asnReplenishmentItem"),RejectReason:n})}),this.data$=yield L({globalReject:this._asn.globalASNRejection(Number(JSON.parse(sessionStorage.getItem("asnReplenishmentItem")).InventoryID)),updateProduct:this._asn.updateProduct({_id:this.replenishmentItem.ProductID,ExcludeFromAutostore:!0}),skip:this._asn.clearSuspect(this._userInfo.userName,this.replenishmentItem.InventoryTrackingNumber,this.replenishmentItem.Barcode,"false")}).pipe(y(N=>O(this,null,function*(){return N.globalReject.data.globalASNRejection.forEach(x=>{o.push({UserEventID:I.Event_Autostore_ASN_ITN_Skipped,UserName:this._userInfo.userName,DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:x.InventoryTrackingNumber,Message:n}),d.push({UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_ITN_Skipped,Log:JSON.stringify({DistributionCenter:f.DistributionCenter,data:x,RejectReason:n})})}),this.log$=yield this._eventLog.insertLog(o,d),N})))}else this.data$=yield L({skip:this._asn.clearSuspect(this._userInfo.userName,this.replenishmentItem.InventoryTrackingNumber,this.replenishmentItem.Barcode,"false"),updateProduct:this._asn.updateProduct({_id:this.replenishmentItem.ProductID,ExcludeFromAutostore:!0})}),this.log$=yield this._eventLog.insertLog([{UserEventID:I.Event_Autostore_ASN_ITN_Skipped,UserName:this._userInfo.userName,DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:JSON.parse(sessionStorage.getItem("asnReplenishmentItem")).InventoryTrackingNumber,Message:n}],[{UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_ITN_Skipped,Log:JSON.stringify({DistributionCenter:f.DistributionCenter,data:sessionStorage.getItem("asnReplenishmentItem"),RejectReason:n})}]);this.skipITN(),this.hideRejectReasons()})}skipITN(){sessionStorage.setItem("asnLocation",this.replenishmentItem.Barcode),this.info$=this._asn.updateASNReplenishmentItem(Number(JSON.parse(sessionStorage.getItem("asnReplenishmentItem"))._id),"skipped").pipe(V(()=>this._findReplenishmentItem.fetch({barcode:sessionStorage.getItem("asnLocation")},{fetchPolicy:"network-only"})),y(n=>n.data.findASNReplenishmentInventory.length==0?(this.error="There are no more replenishment ITNs",h(!1)):(this.replenishmentItem={_id:n.data.findASNReplenishmentInventory[0]._id,InventoryID:n.data.findASNReplenishmentInventory[0].InventoryID,Status:n.data.findASNReplenishmentInventory[0].Status,Barcode:n.data.findASNReplenishmentInventory[0].Barcode,Warehouse:n.data.findASNReplenishmentInventory[0].Warehouse,Row:n.data.findASNReplenishmentInventory[0].Row,Aisle:n.data.findASNReplenishmentInventory[0].Aisle,Section:n.data.findASNReplenishmentInventory[0].Section,Shelf:n.data.findASNReplenishmentInventory[0].Shelf,ShelfDetail:n.data.findASNReplenishmentInventory[0].ShelfDetail,InventoryTrackingNumber:n.data.findASNReplenishmentInventory[0].InventoryTrackingNumber},sessionStorage.setItem("asnReplenishmentItem",JSON.stringify(this.replenishmentItem)),this.log$=this._eventLog.insertLog([{UserEventID:I.Event_Autostore_ASN_ITN_Presented,UserName:this._userInfo.userName,DistributionCenter:f.DistributionCenter,InventoryTrackingNumber:this.replenishmentItem.InventoryTrackingNumber}],[{UserName:this._userInfo.userName,EventTypeID:I.Event_Autostore_ASN_ITN_Presented,Log:JSON.stringify({DistributionCenter:f.DistributionCenter,data:this.replenishmentItem})}]),h(!0))),M(n=>h({error:n})))}};r.\u0275fac=function(l){return new(l||r)(g(ne),g(_e),g(q),g(Q),g(he),g(se),g(ae),g(H))},r.\u0275cmp=R({type:r,selectors:[["ng-component"]],standalone:!0,features:[j],decls:23,vars:22,consts:[["iputType","string","controlName","ITN","title","Scan ITN:",3,"data","formGroup","formSubmit","formBack"],[2,"height","20px"],[4,"ngIf"],[1,"grid","h-12","w-full","grid-cols-4","gap-3","sm:h-16","md:mt-6","md:h-24","lg:h-36"],[1,"col-span-2"],["type","button",1,"h-full","w-full","rounded-lg","bg-red-700","font-medium","text-white","hover:bg-red-500","focus:outline-none","focus:ring-4","focus:ring-red-300","disabled:bg-red-200","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-900",3,"click"],[3,"nzVisible","nzTitle","nzOkDisabled","nzStyle","nzVisibleChange","nzOnCancel","nzOnOk"],["rejectReasonTitleTemplate",""],[4,"nzModalContent"],[3,"itnInfo"],[3,"message","clickSubmit"],[3,"ngModel","ngModelChange"],["nz-radio","",3,"nzValue","click",4,"ngFor","ngForOf"],["nz-radio","",3,"nzValue","click"]],template:function(l,o){if(l&1&&(i(0,"single-input-form",0),S("formSubmit",function(){return o.onSubmit()})("formBack",function(){return o.onBack()}),b(1,"async"),s(),p(2,"div",1),_(3,Ee,2,1,"ng-container",2),b(4,"async"),p(5,"div",1),i(6,"div",3),p(7,"div"),i(8,"div",4)(9,"button",5),S("click",function(){return o.showRejectReasons()}),m(10," Skip "),s()(),p(11,"div"),s(),_(12,De,2,1,"ng-container",2)(13,Ae,1,0,"div",2),b(14,"async"),_(15,je,1,0,"div",2),b(16,"async"),_(17,ze,1,0,"div",2),b(18,"async"),i(19,"nz-modal",6),S("nzVisibleChange",function(N){return o.rejectVisible=N})("nzOnCancel",function(){return o.hideRejectReasons()})("nzOnOk",function(){return o.onOk()}),_(20,we,1,0,"ng-template",null,7,P)(22,Me,3,2,"ng-container",8),s()),l&2){let d=F(21);c("data",T(1,11,o.data$))("formGroup",o.inputForm),a(3),c("ngIf",T(4,13,o.info$)),a(9),c("ngIf",o.error),a(1),c("ngIf",T(14,15,o.test$)),a(2),c("ngIf",T(16,17,o.log$)),a(2),c("ngIf",T(18,19,o.rejectReasons$)),a(2),c("nzVisible",o.rejectVisible)("nzTitle",d)("nzOkDisabled",!o.rejectValue)("nzStyle",G(21,Ve))}},dependencies:[w,J,z,W,fe,re,Y,Z,te,Ie,ge,ce,me,le,K,ue,de,pe,ie,ee],styles:["[nz-radio][_ngcontent-%COMP%]{display:block;height:32px;line-height:32px}input[_ngcontent-%COMP%]{width:100px;margin-left:10px}"]});let t=r;return t})();export{dt as ScanITN};
