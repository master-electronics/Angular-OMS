import{a as y}from"./chunk-PTORZITP.js";import{a as b}from"./chunk-IPTX4HSO.js";import{i as N}from"./chunk-M47XUQY5.js";import{a as D}from"./chunk-YPJKXAYS.js";import{a as p}from"./chunk-I3G2JKLN.js";import{i as _}from"./chunk-LCEARWCQ.js";import{a as L}from"./chunk-4AGTE6D3.js";import{h as g}from"./chunk-MZCJXFXF.js";import{Aa as o,H as m,_ as v,a as s,b as c,n as f,na as I,va as h}from"./chunk-N7LPRJLK.js";var C=(()=>{let i=class i{constructor(){this._currentDatecode=new f(null)}get currentDatecode(){if(this._currentDatecode.value)return this._currentDatecode.value;let t=this.convetDateToWeekNum(new Date);return this._currentDatecode.next(t),t}convetDateToWeekNum(t){let e=new Date(t.valueOf()),r=(t.getDay()+6)%7;e.setDate(e.getDate()-r+3);let n=e.valueOf();e.setMonth(0,1),e.getDay()!==4&&e.setMonth(0,1+(4-e.getDay()+7)%7);let u=1+Math.ceil((n-e.valueOf())/6048e5);return t.getFullYear()%100*100+u}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var H=(()=>{let i=class i{constructor(t,e,r,n,u,d,l){this._update=t,this._receipt=e,this._insertLog=r,this._eventLog=n,this._country=u,this._datecode=d,this._userInfo=l,this._receiptInfo=new f(null)}get receiptInfo(){return this._receiptInfo.value}reset(){this._receiptInfo.next(null)}initReceiptInfo(){let t=this._receipt.receiptInfoAfterFilter().map(e=>e.ReceiptLineID);this._receiptInfo.next({ReceiptLIDs:t,DateCode:"",CountryID:null,ROHS:null,ISO3:""})}updateDateCode(t){this._receiptInfo.next(c(s({},this._receiptInfo.value),{DateCode:t}))}updateCountry(t,e){this._receiptInfo.next(c(s({},this._receiptInfo.value),{CountryID:t,ISO3:e}))}updateROHS(t){this._receiptInfo.next(c(s({},this._receiptInfo.value),{ROHS:t}))}checkDateCode(){return t=>{let e=t.value;return e?g.test(e)?Number(e)>this._datecode.currentDatecode?{value:!0}:null:{format:!0}:null}}countryValidator(){return t=>this._country.countryList$.pipe(m(e=>e.map(r=>({name:r.ISO2+" - "+r.ISO3+" - "+r.CountryName+" - "+r._id}))),m(e=>t.value.length===2?e.some(r=>r.name.substring(0,2).toLocaleUpperCase()===t.value.toLocaleUpperCase()):t.value.length===3?e.some(r=>r.name.substring(5,8).toLocaleUpperCase()===t.value.trim().toLocaleUpperCase()):t.value.length>6?e.some(r=>r.name.toLocaleUpperCase()===t.value.toLocaleUpperCase()):!1),m(e=>e?null:{notExist:!0}),v(1))}passAuthForNotApplicable$(t,e){let r=this._receipt.receiptInfoAfterFilter()[0],n={UserName:this._userInfo.userName,UserEventID:p.Event_Receiving_NotApplicable,Quantity:r.ExpectedQuantity,PartNumber:r.PartNumber,ProductCode:r.ProductCodeNumber,ReceiptHeader:this._receipt.headerID(),PurchaseOrderNumber:r.PurchaseOrderNumber,PurchaseLine:r.PurchaseLineNumber,Message:`${e}|${t}`},u={UserName:this._userInfo.userName,EventTypeID:p.Event_Receiving_NotApplicable,Log:JSON.stringify({Quantity:r.ExpectedQuantity,PartNumber:r.PartNumber,ProductCode:r.ProductCodeNumber,ReceiptHeader:this._receipt.headerID(),PurchaseOrderNumber:r.PurchaseOrderNumber,PurchaseLine:r.PurchaseLineNumber,Supervisor:t,Type:e})};return this._insertLog.mutate({oldLogs:n,eventLogs:u})}updateReceiptLSQL$(){let t=this._update.mutate({idList:this.receiptInfo.ReceiptLIDs,DateCode:this.receiptInfo.DateCode,CountryID:this.receiptInfo.CountryID,ROHS:this.receiptInfo.ROHS}),e=this._receipt.receiptInfoAfterFilter().map(n=>({UserName:this._userInfo.userName,UserEventID:p.Event_Receiving_UpdateInfo,ReceiptLine:n.ReceiptLineNumber,Quantity:n.ExpectedQuantity,PartNumber:n.PartNumber,ProductCode:n.ProductCodeNumber,ReceiptHeader:this._receipt.headerID(),PurchaseOrderNumber:n.PurchaseOrderNumber,PurchaseLine:n.PurchaseLineNumber})),r=this._receipt.receiptInfoAfterFilter().map(n=>c(s({},this._eventLog.eventLog),{EventTypeID:p.Event_Receiving_UpdateInfo,Log:JSON.stringify(s(s({},JSON.parse(this._eventLog.eventLog.Log)),n))}));return this._eventLog.updateEventLog(r[0]),t.pipe(I(()=>this._insertLog.mutate({oldLogs:e,eventLogs:r})))}};i.\u0275fac=function(e){return new(e||i)(o(N),o(b),o(_),o(D),o(y),o(C),o(L))},i.\u0275prov=h({token:i,factory:i.\u0275fac});let a=i;return a})();export{H as a};
